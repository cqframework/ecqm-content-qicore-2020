<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorVersion="2.4.0" translatorOptions="EnableAnnotations,EnableLocators,EnableResultTypes,DisableListDemotion,DisableListPromotion" xsi:type="a:CqlToElmInfo"/>
   <annotation xsi:type="a:Annotation">
      <a:t name="update" value="BTR 2020-03-31 ->&#xa;Incremented version to 5.0.000&#xa;Updated FHIR version to 4.0.1&#xa;Changed timezone keyword to timezoneoffset for use with CQL 1.4&#xa;Removed Normalize Onset in favor of more general Normalize Interval&#xa;Updated CodeSystems for ConditionVerificationStatusCodes and RoleCodes"/>
      <a:t name="update" value="BTR 2021-05-13 ->&#xa;Added ActiveCondition Codes and Inactive Condition Codes value sets&#xa;Added function documentation throughout&#xa;Fixed EDVisit not using Last&#xa;Updated prevalence period to use an inclusive boundary if the condition is active&#xa;Added HasStart, HasEnd, Earliest, and Latest functions&#xa;Removed ToDate and Age calculation functions"/>
      <a:t name="update" value="BTR 2021-06-25 ->&#xa;Added GetBaseExtension overloads for Element"/>
      <a:t name="update" value="BTR 2022-05-24 ->&#xa;Update for 2022 AU content&#xa;Refactor to use CQF.FHIRCommon"/>
      <a:t name="update" value="BTR 2022-06-14 ->&#xa;Update to use QICore&#xa;Rename from MATGlobalCommonFunctionsFHIR4 to MATGlobalCommonFunctionsQICore4&#xa;Added fluent functions&#xa;Removed Normalize Interval"/>
      <a:s r="823">
         <a:s>/*
@update: BTR 2020-03-31 ->
Incremented version to 5.0.000
Updated FHIR version to 4.0.1
Changed timezone keyword to timezoneoffset for use with CQL 1.4
Removed Normalize Onset in favor of more general Normalize Interval
Updated CodeSystems for ConditionVerificationStatusCodes and RoleCodes

@update: BTR 2021-05-13 ->
Added ActiveCondition Codes and Inactive Condition Codes value sets
Added function documentation throughout
Fixed EDVisit not using Last
Updated prevalence period to use an inclusive boundary if the condition is active
Added HasStart, HasEnd, Earliest, and Latest functions
Removed ToDate and Age calculation functions

@update: BTR 2021-06-25 ->
Added GetBaseExtension overloads for Element

@update: BTR 2022-05-24 ->
Update for 2022 AU content
Refactor to use CQF.FHIRCommon

@update: BTR 2022-06-14 ->
Update to use QICore
Rename from MATGlobalCommonFunctionsFHIR4 to MATGlobalCommonFunctionsQICore4
Added fluent functions
Removed Normalize Interval
*/
library MATGlobalCommonFunctionsQICore4 version '7.0.000'</a:s>
      </a:s>
   </annotation>
   <identifier id="MATGlobalCommonFunctionsQICore4" version="7.0.000"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def localId="1" locator="32:1-32:28" localIdentifier="QICore" uri="http://hl7.org/fhir">
         <annotation xsi:type="a:Annotation">
            <a:s r="1">
               <a:s>using </a:s>
               <a:s>
                  <a:s>QICore</a:s>
               </a:s>
               <a:s> version '4.1.1'</a:s>
            </a:s>
         </annotation>
      </def>
   </usings>
   <includes>
      <def localId="2" locator="34:1-34:56" localIdentifier="FHIRHelpers" path="FHIRHelpers" version="4.0.013">
         <annotation xsi:type="a:Annotation">
            <a:s r="2">
               <a:s>include </a:s>
               <a:s>
                  <a:s>FHIRHelpers</a:s>
               </a:s>
               <a:s> version '4.0.013' called FHIRHelpers</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="3" locator="35:1-35:58" localIdentifier="QICoreCommon" path="QICoreCommon" version="1.0.000">
         <annotation xsi:type="a:Annotation">
            <a:s r="3">
               <a:s>include </a:s>
               <a:s>
                  <a:s>QICoreCommon</a:s>
               </a:s>
               <a:s> version '1.0.000' called QICoreCommon</a:s>
            </a:s>
         </annotation>
      </def>
   </includes>
   <parameters>
      <def localId="15" locator="44:1-45:66" name="Measurement Period" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="15">
               <a:s>parameter &quot;Measurement Period&quot; </a:s>
               <a:s r="14">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="13">
                     <a:s>DateTime</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>
  default </a:s>
               <a:s r="12">
                  <a:s r="10">Interval[@2022-01-01T00:00:00.0, @2023-01-01T00:00:00.0)</a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <default localId="12" locator="45:11-45:66" lowClosed="true" highClosed="false" xsi:type="Interval">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <low localId="10" locator="45:20-45:41" resultTypeName="t:DateTime" xsi:type="DateTime">
               <year valueType="t:Integer" value="2022" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="1" xsi:type="Literal"/>
               <hour valueType="t:Integer" value="0" xsi:type="Literal"/>
               <minute valueType="t:Integer" value="0" xsi:type="Literal"/>
               <second valueType="t:Integer" value="0" xsi:type="Literal"/>
               <millisecond valueType="t:Integer" value="0" xsi:type="Literal"/>
            </low>
            <high localId="11" locator="45:44-45:65" resultTypeName="t:DateTime" xsi:type="DateTime">
               <year valueType="t:Integer" value="2023" xsi:type="Literal"/>
               <month valueType="t:Integer" value="1" xsi:type="Literal"/>
               <day valueType="t:Integer" value="1" xsi:type="Literal"/>
               <hour valueType="t:Integer" value="0" xsi:type="Literal"/>
               <minute valueType="t:Integer" value="0" xsi:type="Literal"/>
               <second valueType="t:Integer" value="0" xsi:type="Literal"/>
               <millisecond valueType="t:Integer" value="0" xsi:type="Literal"/>
            </high>
         </default>
         <parameterTypeSpecifier localId="14" locator="44:32-44:49" xsi:type="IntervalTypeSpecifier">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <pointType localId="13" locator="44:41-44:48" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </parameterTypeSpecifier>
      </def>
   </parameters>
   <valueSets>
      <def localId="4" locator="37:1-37:111" resultTypeName="t:ValueSet" name="Emergency Department Visit" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.117.1.7.1.292" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="4">
               <a:s>valueset &quot;Emergency Department Visit&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.117.1.7.1.292'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="5" locator="38:1-38:100" resultTypeName="t:ValueSet" name="Encounter Inpatient" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.666.5.307" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="5">
               <a:s>valueset &quot;Encounter Inpatient&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113883.3.666.5.307'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="6" locator="39:1-39:101" resultTypeName="t:ValueSet" name="Intensive Care Unit" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1029.206" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="6">
               <a:s>valueset &quot;Intensive Care Unit&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1029.206'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="7" locator="40:1-40:102" resultTypeName="t:ValueSet" name="Observation Services" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1111.143" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="7">
               <a:s>valueset &quot;Observation Services&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1111.143'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="8" locator="41:1-41:107" resultTypeName="t:ValueSet" name="Outpatient Surgery Service" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1110.38" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="8">
               <a:s>valueset &quot;Outpatient Surgery Service&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1110.38'</a:s>
            </a:s>
         </annotation>
      </def>
      <def localId="9" locator="42:1-42:129" resultTypeName="t:ValueSet" name="Present on Admission or Clinically Undetermined" id="http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1147.197" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="9">
               <a:s>valueset &quot;Present on Admission or Clinically Undetermined&quot;: 'http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.113762.1.4.1147.197'</a:s>
            </a:s>
         </annotation>
      </def>
   </valueSets>
   <contexts>
      <def locator="47:1-47:15" name="Patient"/>
   </contexts>
   <statements>
      <def locator="47:1-47:15" name="Patient" context="Patient">
         <expression xsi:type="SingletonFrom">
            <operand locator="47:1-47:15" dataType="fhir:Patient" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-patient" xsi:type="Retrieve"/>
         </expression>
      </def>
      <def localId="31" locator="68:1-69:60" resultTypeName="t:Integer" name="LengthInDays" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="31">
               <a:s>/*
Calculates the difference in calendar days between the start and end of the given interval.
*/
define function &quot;LengthInDays&quot;(Value </a:s>
               <a:s r="25">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="24">
                     <a:s>DateTime</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="30">
                  <a:s r="30">
                     <a:s>difference in days between </a:s>
                     <a:s r="27">
                        <a:s>start of </a:s>
                        <a:s r="26">
                           <a:s>Value</a:s>
                        </a:s>
                     </a:s>
                     <a:s> and </a:s>
                     <a:s r="29">
                        <a:s>end of </a:s>
                        <a:s r="28">
                           <a:s>Value</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="30" locator="69:3-69:60" resultTypeName="t:Integer" precision="Day" xsi:type="DifferenceBetween">
            <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            <operand localId="27" locator="69:30-69:43" resultTypeName="t:DateTime" xsi:type="Start">
               <signature xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </signature>
               <operand localId="26" locator="69:39-69:43" name="Value" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
               </operand>
            </operand>
            <operand localId="29" locator="69:49-69:60" resultTypeName="t:DateTime" xsi:type="End">
               <signature xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </signature>
               <operand localId="28" locator="69:56-69:60" name="Value" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
               </operand>
            </operand>
         </expression>
         <operand name="Value">
            <operandTypeSpecifier localId="25" locator="68:38-68:55" xsi:type="IntervalTypeSpecifier">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <pointType localId="24" locator="68:47-68:54" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="42" locator="49:1-53:72" name="Inpatient Encounter" context="Patient" accessLevel="Public">
         <annotation xsi:type="a:Annotation">
            <a:s r="42">
               <a:s>define &quot;Inpatient Encounter&quot;:
  </a:s>
               <a:s r="41">
                  <a:s>
                     <a:s r="17">
                        <a:s r="16">
                           <a:s r="16">
                              <a:s>[Encounter: </a:s>
                              <a:s>
                                 <a:s>&quot;Encounter Inpatient&quot;</a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                        <a:s> EncounterInpatient</a:s>
                     </a:s>
                  </a:s>
                  <a:s>
		</a:s>
                  <a:s r="40">
                     <a:s>where </a:s>
                     <a:s r="40">
                        <a:s r="35">
                           <a:s r="21">
                              <a:s r="19">
                                 <a:s r="18">
                                    <a:s>EncounterInpatient</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="19">
                                    <a:s>status</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> = </a:s>
                              <a:s r="20">
                                 <a:s>'finished'</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
	    and </a:s>
                           <a:s r="34">
                              <a:s r="32">
                                 <a:s>&quot;LengthInDays&quot;(</a:s>
                                 <a:s r="23">
                                    <a:s r="22">
                                       <a:s>EncounterInpatient</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="23">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s r="33"> &lt;= 120</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
			and </a:s>
                        <a:s r="39">
                           <a:s r="37">
                              <a:s r="36">
                                 <a:s>EncounterInpatient</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="37">
                                 <a:s>period</a:s>
                              </a:s>
                           </a:s>
                           <a:s r="39"> ends during day of </a:s>
                           <a:s r="38">
                              <a:s>&quot;Measurement Period&quot;</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="41" locator="50:3-53:72" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="17" locator="50:3-50:55" alias="EncounterInpatient">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="16" locator="50:3-50:36" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <codes locator="50:15-50:35" resultTypeName="t:ValueSet" name="Encounter Inpatient" preserve="true" xsi:type="ValueSetRef"/>
               </expression>
            </source>
            <where localId="40" locator="51:3-53:72" resultTypeName="t:Boolean" xsi:type="And">
               <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
               <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
               <operand localId="35" locator="51:9-52:57" resultTypeName="t:Boolean" xsi:type="And">
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="21" locator="51:9-51:46" resultTypeName="t:Boolean" xsi:type="Equal">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="19" locator="51:9-51:33" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                        <source path="status" scope="EncounterInpatient" xsi:type="Property"/>
                     </operand>
                     <operand localId="20" locator="51:37-51:46" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                  </operand>
                  <operand localId="34" locator="52:10-52:57" resultTypeName="t:Boolean" xsi:type="LessOrEqual">
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="32" locator="52:10-52:50" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="23" locator="52:25-52:49" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" scope="EncounterInpatient" xsi:type="Property"/>
                        </operand>
                     </operand>
                     <operand localId="33" locator="52:55-52:57" resultTypeName="t:Integer" valueType="t:Integer" value="120" xsi:type="Literal"/>
                  </operand>
               </operand>
               <operand localId="39" locator="53:8-53:72" resultTypeName="t:Boolean" precision="Day" xsi:type="In">
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand locator="53:34-53:37" xsi:type="End">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="37" locator="53:8-53:32" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="EncounterInpatient" xsi:type="Property"/>
                     </operand>
                  </operand>
                  <operand localId="38" locator="53:53-53:72" name="Measurement Period" xsi:type="ParameterRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
               </operand>
            </where>
         </expression>
      </def>
      <def localId="52" locator="62:1-63:62" name="ToDateInterval" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:t name="description" value="Returns an interval of date values extracted from the input interval of date-time values"/>
            <a:t name="comment" value="This function returns an interval constructed using the `date from` extractor on the start&#xa;and end values of the input date-time interval. Note that using a precision specifier such as `day of`&#xa;as part of a timing phrase is preferred to communicate intent to perform day-level comparison, as well&#xa;as for general readability."/>
            <a:s r="52">
               <a:s>/*
@description: Returns an interval of date values extracted from the input interval of date-time values
@comment: This function returns an interval constructed using the `date from` extractor on the start
and end values of the input date-time interval. Note that using a precision specifier such as `day of`
as part of a timing phrase is preferred to communicate intent to perform day-level comparison, as well
as for general readability.
*/
define function &quot;ToDateInterval&quot;(period </a:s>
               <a:s r="44">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="43">
                     <a:s>DateTime</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="51">
                  <a:s r="51">
                     <a:s>Interval[</a:s>
                     <a:s r="47">
                        <a:s>date from </a:s>
                        <a:s r="46">
                           <a:s>start of </a:s>
                           <a:s r="45">
                              <a:s>period</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>, </a:s>
                     <a:s r="50">
                        <a:s>date from </a:s>
                        <a:s r="49">
                           <a:s>end of </a:s>
                           <a:s r="48">
                              <a:s>period</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>]</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:Date" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="51" locator="63:3-63:62" lowClosed="true" highClosed="true" xsi:type="Interval">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:Date" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <low localId="47" locator="63:12-63:36" resultTypeName="t:Date" xsi:type="DateFrom">
               <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               <operand localId="46" locator="63:22-63:36" resultTypeName="t:DateTime" xsi:type="Start">
                  <signature xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="45" locator="63:31-63:36" name="period" xsi:type="OperandRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
               </operand>
            </low>
            <high localId="50" locator="63:39-63:61" resultTypeName="t:Date" xsi:type="DateFrom">
               <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               <operand localId="49" locator="63:49-63:61" resultTypeName="t:DateTime" xsi:type="End">
                  <signature xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="48" locator="63:56-63:61" name="period" xsi:type="OperandRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </operand>
               </operand>
            </high>
         </expression>
         <operand name="period">
            <operandTypeSpecifier localId="44" locator="62:41-62:58" xsi:type="IntervalTypeSpecifier">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <pointType localId="43" locator="62:50-62:57" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="63" locator="74:1-75:60" resultTypeName="t:Integer" name="lengthInDays" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="63">
               <a:s>/*
Calculates the difference in calendar days between the start and end of the given interval.
*/
define fluent function lengthInDays(Value </a:s>
               <a:s r="57">
                  <a:s>Interval&lt;</a:s>
                  <a:s r="56">
                     <a:s>DateTime</a:s>
                  </a:s>
                  <a:s>></a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="62">
                  <a:s r="62">
                     <a:s>difference in days between </a:s>
                     <a:s r="59">
                        <a:s>start of </a:s>
                        <a:s r="58">
                           <a:s>Value</a:s>
                        </a:s>
                     </a:s>
                     <a:s> and </a:s>
                     <a:s r="61">
                        <a:s>end of </a:s>
                        <a:s r="60">
                           <a:s>Value</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="62" locator="75:3-75:60" resultTypeName="t:Integer" precision="Day" xsi:type="DifferenceBetween">
            <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            <operand localId="59" locator="75:30-75:43" resultTypeName="t:DateTime" xsi:type="Start">
               <signature xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </signature>
               <operand localId="58" locator="75:39-75:43" name="Value" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
               </operand>
            </operand>
            <operand localId="61" locator="75:49-75:60" resultTypeName="t:DateTime" xsi:type="End">
               <signature xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </signature>
               <operand localId="60" locator="75:56-75:60" name="Value" xsi:type="OperandRef">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
               </operand>
            </operand>
         </expression>
         <operand name="Value">
            <operandTypeSpecifier localId="57" locator="74:43-74:60" xsi:type="IntervalTypeSpecifier">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <pointType localId="56" locator="74:52-74:59" resultTypeName="t:DateTime" name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def localId="85" locator="80:1-86:5" resultTypeName="fhir:Encounter" name="ED Visit" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="85">
               <a:s>/*
Returns the most recent emergency department visit, if any, that occurs 1 hour or less prior to the given encounter.
*/
define function &quot;ED Visit&quot;(TheEncounter </a:s>
               <a:s r="64">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="84">
                  <a:s r="84">
                     <a:s>Last(
    </a:s>
                     <a:s r="83">
                        <a:s>
                           <a:s r="66">
                              <a:s r="65">
                                 <a:s r="65">
                                    <a:s>[Encounter: </a:s>
                                    <a:s>
                                       <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                    </a:s>
                                    <a:s>]</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> EDVisit</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="78">
                           <a:s>where </a:s>
                           <a:s r="78">
                              <a:s r="70">
                                 <a:s r="68">
                                    <a:s r="67">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="68">
                                       <a:s>status</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="69">
                                    <a:s>'finished'</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        and </a:s>
                              <a:s r="77">
                                 <a:s r="72">
                                    <a:s r="71">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="72">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="77">
                                    <a:s>ends </a:s>
                                    <a:s r="76">
                                       <a:s>1 hour</a:s>
                                    </a:s>
                                    <a:s> or less on or before</a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="75">
                                    <a:s>start of </a:s>
                                    <a:s r="74">
                                       <a:s r="73">
                                          <a:s>TheEncounter</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="74">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="82">
                           <a:s>sort by </a:s>
                           <a:s r="81">
                              <a:s r="80">
                                 <a:s>end of </a:s>
                                 <a:s r="79">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="84" locator="81:3-86:5" resultTypeName="fhir:Encounter" xsi:type="Last">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <source localId="83" locator="82:5-85:27" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="66" locator="82:5-82:53" alias="EDVisit">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="65" locator="82:5-82:45" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <codes locator="82:17-82:44" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                  </expression>
               </source>
               <where localId="78" locator="83:7-84:88" resultTypeName="t:Boolean" xsi:type="And">
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="70" locator="83:13-83:39" resultTypeName="t:Boolean" xsi:type="Equal">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="68" locator="83:13-83:26" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                        <source path="status" scope="EDVisit" xsi:type="Property"/>
                     </operand>
                     <operand localId="69" locator="83:30-83:39" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                  </operand>
                  <operand localId="77" locator="84:13-84:88" resultTypeName="t:Boolean" xsi:type="And">
                     <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                     <operand locator="84:33-84:46" xsi:type="In">
                        <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand locator="84:28-84:31" xsi:type="End">
                           <signature xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </signature>
                           <operand localId="72" locator="84:13-84:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand path="period" scope="EDVisit" xsi:type="Property"/>
                           </operand>
                        </operand>
                        <operand locator="84:33-84:46" lowClosed="true" highClosed="true" xsi:type="Interval">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <low locator="84:61-84:88" xsi:type="Subtract">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="75" locator="84:61-84:88" resultTypeName="t:DateTime" xsi:type="Start">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="74" locator="84:70-84:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" xsi:type="Property">
                                       <source localId="73" locator="84:70-84:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                              <operand localId="76" locator="84:33-84:38" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                           </low>
                           <high localId="75" locator="84:61-84:88" resultTypeName="t:DateTime" xsi:type="Start">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="74" locator="84:70-84:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" xsi:type="Property">
                                    <source localId="73" locator="84:70-84:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                           </high>
                        </operand>
                     </operand>
                     <operand locator="84:33-84:46" xsi:type="Not">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand locator="84:33-84:46" xsi:type="IsNull">
                           <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="75" locator="84:61-84:88" resultTypeName="t:DateTime" xsi:type="Start">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="74" locator="84:70-84:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" xsi:type="Property">
                                    <source localId="73" locator="84:70-84:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <sort localId="82" locator="85:7-85:27">
                  <by localId="81" locator="85:15-85:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                     <expression localId="80" locator="85:15-85:27" resultTypeName="t:DateTime" xsi:type="End">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="79" locator="85:22-85:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="64" locator="80:41-80:49" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="107" locator="91:1-97:5" resultTypeName="fhir:Encounter" name="edVisit" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="107">
               <a:s>/*
Returns the most recent emergency department visit, if any, that occurs 1 hour or less prior to the given encounter.
*/
define fluent function edVisit(TheEncounter </a:s>
               <a:s r="86">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="106">
                  <a:s r="106">
                     <a:s>Last(
    </a:s>
                     <a:s r="105">
                        <a:s>
                           <a:s r="88">
                              <a:s r="87">
                                 <a:s r="87">
                                    <a:s>[Encounter: </a:s>
                                    <a:s>
                                       <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                    </a:s>
                                    <a:s>]</a:s>
                                 </a:s>
                              </a:s>
                              <a:s> EDVisit</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="100">
                           <a:s>where </a:s>
                           <a:s r="100">
                              <a:s r="92">
                                 <a:s r="90">
                                    <a:s r="89">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="90">
                                       <a:s>status</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="91">
                                    <a:s>'finished'</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
        and </a:s>
                              <a:s r="99">
                                 <a:s r="94">
                                    <a:s r="93">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="94">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="99">
                                    <a:s>ends </a:s>
                                    <a:s r="98">
                                       <a:s>1 hour</a:s>
                                    </a:s>
                                    <a:s> or less on or before</a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="97">
                                    <a:s>start of </a:s>
                                    <a:s r="96">
                                       <a:s r="95">
                                          <a:s>TheEncounter</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="96">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
      </a:s>
                        <a:s r="104">
                           <a:s>sort by </a:s>
                           <a:s r="103">
                              <a:s r="102">
                                 <a:s>end of </a:s>
                                 <a:s r="101">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    )</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="106" locator="92:3-97:5" resultTypeName="fhir:Encounter" xsi:type="Last">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <source localId="105" locator="93:5-96:27" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="88" locator="93:5-93:53" alias="EDVisit">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="87" locator="93:5-93:45" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <codes locator="93:17-93:44" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                  </expression>
               </source>
               <where localId="100" locator="94:7-95:88" resultTypeName="t:Boolean" xsi:type="And">
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="92" locator="94:13-94:39" resultTypeName="t:Boolean" xsi:type="Equal">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="90" locator="94:13-94:26" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                        <source path="status" scope="EDVisit" xsi:type="Property"/>
                     </operand>
                     <operand localId="91" locator="94:30-94:39" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                  </operand>
                  <operand localId="99" locator="95:13-95:88" resultTypeName="t:Boolean" xsi:type="And">
                     <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                     <operand locator="95:33-95:46" xsi:type="In">
                        <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand locator="95:28-95:31" xsi:type="End">
                           <signature xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </signature>
                           <operand localId="94" locator="95:13-95:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <operand path="period" scope="EDVisit" xsi:type="Property"/>
                           </operand>
                        </operand>
                        <operand locator="95:33-95:46" lowClosed="true" highClosed="true" xsi:type="Interval">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <low locator="95:61-95:88" xsi:type="Subtract">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="97" locator="95:61-95:88" resultTypeName="t:DateTime" xsi:type="Start">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="96" locator="95:70-95:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" xsi:type="Property">
                                       <source localId="95" locator="95:70-95:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                    </operand>
                                 </operand>
                              </operand>
                              <operand localId="98" locator="95:33-95:38" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                           </low>
                           <high localId="97" locator="95:61-95:88" resultTypeName="t:DateTime" xsi:type="Start">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="96" locator="95:70-95:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" xsi:type="Property">
                                    <source localId="95" locator="95:70-95:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                           </high>
                        </operand>
                     </operand>
                     <operand locator="95:33-95:46" xsi:type="Not">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand locator="95:33-95:46" xsi:type="IsNull">
                           <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="97" locator="95:61-95:88" resultTypeName="t:DateTime" xsi:type="Start">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="96" locator="95:70-95:88" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" xsi:type="Property">
                                    <source localId="95" locator="95:70-95:81" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <sort localId="104" locator="96:7-96:27">
                  <by localId="103" locator="96:15-96:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                     <expression localId="102" locator="96:15-96:27" resultTypeName="t:DateTime" xsi:type="End">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="101" locator="96:22-96:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="86" locator="91:45-91:53" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="126" locator="102:1-106:68" name="Hospitalization" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="126">
               <a:s>/*
Hospitalization returns the total interval for admission to discharge for the given encounter, or for the admission of any immediately prior emergency department visit to the discharge of the given encounter.
*/
define function &quot;Hospitalization&quot;(TheEncounter </a:s>
               <a:s r="108">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="125">
                  <a:s r="125">
                     <a:s>
                        <a:s r="111">
                           <a:s r="110">
                              <a:s>( </a:s>
                              <a:s r="110">
                                 <a:s>&quot;ED Visit&quot;(</a:s>
                                 <a:s r="109">
                                    <a:s>TheEncounter</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                           <a:s> X</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="124">
                        <a:s>return
        </a:s>
                        <a:s r="123">
                           <a:s>if </a:s>
                           <a:s r="113">
                              <a:s r="112">
                                 <a:s>X</a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="115">
                              <a:s r="114">
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="115">
                                 <a:s>period</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        else </a:s>
                           <a:s r="122">
                              <a:s>Interval[</a:s>
                              <a:s r="118">
                                 <a:s>start of </a:s>
                                 <a:s r="117">
                                    <a:s r="116">
                                       <a:s>X</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="117">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="121">
                                 <a:s>end of </a:s>
                                 <a:s r="120">
                                    <a:s r="119">
                                       <a:s>TheEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="120">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="125" locator="103:3-106:68" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="111" locator="103:3-103:32" resultTypeName="fhir:Encounter" alias="X">
               <expression localId="110" locator="103:3-103:30" resultTypeName="fhir:Encounter" name="ED Visit" xsi:type="FunctionRef">
                  <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="109" locator="103:16-103:27" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="124" locator="104:5-106:68">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="123" locator="105:9-106:68" xsi:type="If">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="113" locator="105:12-105:20" resultTypeName="t:Boolean" xsi:type="IsNull">
                     <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="112" locator="105:12" resultTypeName="fhir:Encounter" name="X" xsi:type="AliasRef"/>
                  </condition>
                  <then localId="115" locator="105:27-105:45" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <operand path="period" xsi:type="Property">
                        <source localId="114" locator="105:27-105:38" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                     </operand>
                  </then>
                  <else localId="122" locator="106:14-106:68" lowClosed="true" highClosed="false" xsi:type="Interval">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <low localId="118" locator="106:23-106:39" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="117" locator="106:32-106:39" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" scope="X" xsi:type="Property"/>
                        </operand>
                     </low>
                     <high localId="121" locator="106:42-106:67" resultTypeName="t:DateTime" xsi:type="End">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="120" locator="106:49-106:67" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="119" locator="106:49-106:60" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </high>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="108" locator="102:48-102:56" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="145" locator="111:1-115:68" name="hospitalization" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="145">
               <a:s>/*
Hospitalization returns the total interval for admission to discharge for the given encounter, or for the admission of any immediately prior emergency department visit to the discharge of the given encounter.
*/
define fluent function hospitalization(TheEncounter </a:s>
               <a:s r="127">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="144">
                  <a:s r="144">
                     <a:s>
                        <a:s r="130">
                           <a:s r="129">
                              <a:s>( </a:s>
                              <a:s r="129">
                                 <a:s>&quot;ED Visit&quot;(</a:s>
                                 <a:s r="128">
                                    <a:s>TheEncounter</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                           <a:s> X</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="143">
                        <a:s>return
        </a:s>
                        <a:s r="142">
                           <a:s>if </a:s>
                           <a:s r="132">
                              <a:s r="131">
                                 <a:s>X</a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="134">
                              <a:s r="133">
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="134">
                                 <a:s>period</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        else </a:s>
                           <a:s r="141">
                              <a:s>Interval[</a:s>
                              <a:s r="137">
                                 <a:s>start of </a:s>
                                 <a:s r="136">
                                    <a:s r="135">
                                       <a:s>X</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="136">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="140">
                                 <a:s>end of </a:s>
                                 <a:s r="139">
                                    <a:s r="138">
                                       <a:s>TheEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="139">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>]</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="144" locator="112:3-115:68" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="130" locator="112:3-112:32" resultTypeName="fhir:Encounter" alias="X">
               <expression localId="129" locator="112:3-112:30" resultTypeName="fhir:Encounter" name="ED Visit" xsi:type="FunctionRef">
                  <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="128" locator="112:16-112:27" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="143" locator="113:5-115:68">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="142" locator="114:9-115:68" xsi:type="If">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="132" locator="114:12-114:20" resultTypeName="t:Boolean" xsi:type="IsNull">
                     <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="131" locator="114:12" resultTypeName="fhir:Encounter" name="X" xsi:type="AliasRef"/>
                  </condition>
                  <then localId="134" locator="114:27-114:45" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <operand path="period" xsi:type="Property">
                        <source localId="133" locator="114:27-114:38" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                     </operand>
                  </then>
                  <else localId="141" locator="115:14-115:68" lowClosed="true" highClosed="true" xsi:type="Interval">
                     <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <low localId="137" locator="115:23-115:39" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="136" locator="115:32-115:39" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" scope="X" xsi:type="Property"/>
                        </operand>
                     </low>
                     <high localId="140" locator="115:42-115:67" resultTypeName="t:DateTime" xsi:type="End">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="139" locator="115:49-115:67" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="138" locator="115:49-115:60" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </operand>
                        </operand>
                     </high>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="127" locator="111:53-111:61" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="163" locator="120:1-124:68" name="Hospitalization Locations" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="163">
               <a:s>/*
Returns list of all locations within an encounter, including locations for immediately prior ED visit.
*/
define function &quot;Hospitalization Locations&quot;(TheEncounter </a:s>
               <a:s r="146">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="162">
                  <a:s r="162">
                     <a:s>
                        <a:s r="149">
                           <a:s r="148">
                              <a:s>( </a:s>
                              <a:s r="148">
                                 <a:s>&quot;ED Visit&quot;(</a:s>
                                 <a:s r="147">
                                    <a:s>TheEncounter</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                           <a:s> EDEncounter</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="161">
                        <a:s>return
        </a:s>
                        <a:s r="160">
                           <a:s>if </a:s>
                           <a:s r="151">
                              <a:s r="150">
                                 <a:s>EDEncounter</a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="153">
                              <a:s r="152">
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="153">
                                 <a:s>location</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        else </a:s>
                           <a:s r="159">
                              <a:s>flatten </a:s>
                              <a:s r="158">
                                 <a:s>{ </a:s>
                                 <a:s r="155">
                                    <a:s r="154">
                                       <a:s>EDEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="155">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="157">
                                    <a:s r="156">
                                       <a:s>TheEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="157">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="162" locator="121:3-124:68" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="149" locator="121:3-121:42" resultTypeName="fhir:Encounter" alias="EDEncounter">
               <expression localId="148" locator="121:3-121:30" resultTypeName="fhir:Encounter" name="ED Visit" xsi:type="FunctionRef">
                  <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="147" locator="121:16-121:27" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="161" locator="122:5-124:68">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="160" locator="123:9-124:68" xsi:type="If">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="151" locator="123:12-123:30" resultTypeName="t:Boolean" xsi:type="IsNull">
                     <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="150" locator="123:12-123:22" resultTypeName="fhir:Encounter" name="EDEncounter" xsi:type="AliasRef"/>
                  </condition>
                  <then localId="153" locator="123:37-123:57" path="location" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="152" locator="123:37-123:48" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                  </then>
                  <else localId="159" locator="124:14-124:68" xsi:type="Flatten">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </signature>
                     <operand localId="158" locator="124:22-124:68" xsi:type="List">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </resultTypeSpecifier>
                        <element localId="155" locator="124:24-124:43" path="location" scope="EDEncounter" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </element>
                        <element localId="157" locator="124:46-124:66" path="location" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source localId="156" locator="124:46-124:57" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                        </element>
                     </operand>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="146" locator="120:58-120:66" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="181" locator="129:1-133:68" name="hospitalizationLocations" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="181">
               <a:s>/*
Returns list of all locations within an encounter, including locations for immediately prior ED visit.
*/
define fluent function hospitalizationLocations(TheEncounter </a:s>
               <a:s r="164">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="180">
                  <a:s r="180">
                     <a:s>
                        <a:s r="167">
                           <a:s r="166">
                              <a:s>( </a:s>
                              <a:s r="166">
                                 <a:s>&quot;ED Visit&quot;(</a:s>
                                 <a:s r="165">
                                    <a:s>TheEncounter</a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s> )</a:s>
                           </a:s>
                           <a:s> EDEncounter</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="179">
                        <a:s>return
        </a:s>
                        <a:s r="178">
                           <a:s>if </a:s>
                           <a:s r="169">
                              <a:s r="168">
                                 <a:s>EDEncounter</a:s>
                              </a:s>
                              <a:s> is null</a:s>
                           </a:s>
                           <a:s> then </a:s>
                           <a:s r="171">
                              <a:s r="170">
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                              <a:s>.</a:s>
                              <a:s r="171">
                                 <a:s>location</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
        else </a:s>
                           <a:s r="177">
                              <a:s>flatten </a:s>
                              <a:s r="176">
                                 <a:s>{ </a:s>
                                 <a:s r="173">
                                    <a:s r="172">
                                       <a:s>EDEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="173">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>, </a:s>
                                 <a:s r="175">
                                    <a:s r="174">
                                       <a:s>TheEncounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="175">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> }</a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="180" locator="130:3-133:68" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="167" locator="130:3-130:42" resultTypeName="fhir:Encounter" alias="EDEncounter">
               <expression localId="166" locator="130:3-130:30" resultTypeName="fhir:Encounter" name="ED Visit" xsi:type="FunctionRef">
                  <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="165" locator="130:16-130:27" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="179" locator="131:5-133:68">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="178" locator="132:9-133:68" xsi:type="If">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <condition localId="169" locator="132:12-132:30" resultTypeName="t:Boolean" xsi:type="IsNull">
                     <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="168" locator="132:12-132:22" resultTypeName="fhir:Encounter" name="EDEncounter" xsi:type="AliasRef"/>
                  </condition>
                  <then localId="171" locator="132:37-132:57" path="location" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="170" locator="132:37-132:48" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                  </then>
                  <else localId="177" locator="133:14-133:68" xsi:type="Flatten">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </elementType>
                     </signature>
                     <operand localId="176" locator="133:22-133:68" xsi:type="List">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </elementType>
                        </resultTypeSpecifier>
                        <element localId="173" locator="133:24-133:43" path="location" scope="EDEncounter" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </element>
                        <element localId="175" locator="133:46-133:66" path="location" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source localId="174" locator="133:46-133:57" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                        </element>
                     </operand>
                  </else>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="164" locator="129:62-129:70" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="186" locator="138:1-139:47" resultTypeName="t:Integer" name="Hospitalization Length of Stay" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="186">
               <a:s>/*
Returns the length of stay in days (i.e. the number of days between admission and discharge) for the given encounter, or from the admission of any immediately prior emergency department visit to the discharge of the encounter
*/
define function &quot;Hospitalization Length of Stay&quot;(TheEncounter </a:s>
               <a:s r="182">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="185">
                  <a:s r="185">
                     <a:s>LengthInDays(</a:s>
                     <a:s r="184">
                        <a:s>&quot;Hospitalization&quot;(</a:s>
                        <a:s r="183">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="185" locator="139:3-139:47" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="184" locator="139:16-139:46" name="Hospitalization" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               <operand localId="183" locator="139:34-139:45" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="182" locator="138:63-138:71" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="191" locator="144:1-145:47" resultTypeName="t:Integer" name="hospitalizationLengthOfStay" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="191">
               <a:s>/*
Returns the length of stay in days (i.e. the number of days between admission and discharge) for the given encounter, or from the admission of any immediately prior emergency department visit to the discharge of the encounter
*/
define fluent function hospitalizationLengthOfStay(TheEncounter </a:s>
               <a:s r="187">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="190">
                  <a:s r="190">
                     <a:s>LengthInDays(</a:s>
                     <a:s r="189">
                        <a:s>&quot;Hospitalization&quot;(</a:s>
                        <a:s r="188">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="190" locator="145:3-145:47" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="189" locator="145:16-145:46" name="Hospitalization" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               <operand localId="188" locator="145:34-145:45" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="187" locator="144:65-144:73" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="196" locator="150:1-151:42" resultTypeName="t:DateTime" name="Hospital Admission Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="196">
               <a:s>/*
Returns admission time for an encounter or for immediately prior emergency department visit.
*/
define function &quot;Hospital Admission Time&quot;(TheEncounter </a:s>
               <a:s r="192">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="195">
                  <a:s r="195">
                     <a:s>start of </a:s>
                     <a:s r="194">
                        <a:s>&quot;Hospitalization&quot;(</a:s>
                        <a:s r="193">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="195" locator="151:3-151:42" resultTypeName="t:DateTime" xsi:type="Start">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="194" locator="151:12-151:42" name="Hospitalization" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               <operand localId="193" locator="151:30-151:41" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="192" locator="150:56-150:64" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="201" locator="156:1-157:42" resultTypeName="t:DateTime" name="hospitalAdmissionTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="201">
               <a:s>/*
Returns admission time for an encounter or for immediately prior emergency department visit.
*/
define fluent function hospitalAdmissionTime(TheEncounter </a:s>
               <a:s r="197">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="200">
                  <a:s r="200">
                     <a:s>start of </a:s>
                     <a:s r="199">
                        <a:s>&quot;Hospitalization&quot;(</a:s>
                        <a:s r="198">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="200" locator="157:3-157:42" resultTypeName="t:DateTime" xsi:type="Start">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="199" locator="157:12-157:42" name="Hospitalization" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               <operand localId="198" locator="157:30-157:41" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="197" locator="156:59-156:67" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="206" locator="162:1-163:28" resultTypeName="t:DateTime" name="Hospital Discharge Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="206">
               <a:s>/*
Hospital Discharge Time returns the discharge time for an encounter
*/
define function &quot;Hospital Discharge Time&quot;(TheEncounter </a:s>
               <a:s r="202">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="205">
                  <a:s r="205">
                     <a:s>end of </a:s>
                     <a:s r="204">
                        <a:s r="203">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="204">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="205" locator="163:3-163:28" resultTypeName="t:DateTime" xsi:type="End">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="204" locator="163:10-163:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="203" locator="163:10-163:21" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="202" locator="162:56-162:64" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="211" locator="168:1-169:28" resultTypeName="t:DateTime" name="hospitalDischargeTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="211">
               <a:s>/*
Hospital Discharge Time returns the discharge time for an encounter
*/
define fluent function hospitalDischargeTime(TheEncounter </a:s>
               <a:s r="207">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="210">
                  <a:s r="210">
                     <a:s>end of </a:s>
                     <a:s r="209">
                        <a:s r="208">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="209">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="210" locator="169:3-169:28" resultTypeName="t:DateTime" xsi:type="End">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="209" locator="169:10-169:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="208" locator="169:10-169:21" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="207" locator="168:59-168:67" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="224" locator="174:1-178:11" resultTypeName="t:DateTime" name="Hospital Arrival Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="224">
               <a:s>/*
Returns earliest arrival time for an encounter including any prior ED visit.
*/
define function &quot;Hospital Arrival Time&quot;(TheEncounter </a:s>
               <a:s r="212">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="223">
                  <a:s r="223">
                     <a:s>start of </a:s>
                     <a:s r="222">
                        <a:s r="221">
                           <a:s>First(
  	    </a:s>
                           <a:s r="220">
                              <a:s>
                                 <a:s r="215">
                                    <a:s r="214">
                                       <a:s>( </a:s>
                                       <a:s r="214">
                                          <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                          <a:s r="213">
                                             <a:s>TheEncounter</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s> )</a:s>
                                    </a:s>
                                    <a:s> HospitalLocation</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
  			</a:s>
                              <a:s r="219">
                                 <a:s>sort by </a:s>
                                 <a:s r="218">
                                    <a:s r="217">
                                       <a:s>start of </a:s>
                                       <a:s r="216">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
  	)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="222">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="223" locator="175:3-178:11" resultTypeName="t:DateTime" xsi:type="Start">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="222" locator="175:12-178:11" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="221" locator="175:12-178:4" resultTypeName="fhir:Encounter.Location" xsi:type="First">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <source localId="220" locator="176:8-177:28" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="215" locator="176:8-176:69" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="214" locator="176:8-176:52" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="213" locator="176:38-176:49" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <sort localId="219" locator="177:6-177:28">
                           <by localId="218" locator="177:14-177:28" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                              <expression localId="217" locator="177:14-177:28" resultTypeName="t:DateTime" xsi:type="Start">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="216" locator="177:23-177:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand name="period" xsi:type="IdentifierRef"/>
                                 </operand>
                              </expression>
                           </by>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="212" locator="174:54-174:62" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="237" locator="183:1-187:11" resultTypeName="t:DateTime" name="hospitalArrivalTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="237">
               <a:s>/*
Returns earliest arrival time for an encounter including any prior ED visit.
*/
define fluent function hospitalArrivalTime(TheEncounter </a:s>
               <a:s r="225">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="236">
                  <a:s r="236">
                     <a:s>start of </a:s>
                     <a:s r="235">
                        <a:s r="234">
                           <a:s>First(
  	    </a:s>
                           <a:s r="233">
                              <a:s>
                                 <a:s r="228">
                                    <a:s r="227">
                                       <a:s>( </a:s>
                                       <a:s r="227">
                                          <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                          <a:s r="226">
                                             <a:s>TheEncounter</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s> )</a:s>
                                    </a:s>
                                    <a:s> HospitalLocation</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
  			</a:s>
                              <a:s r="232">
                                 <a:s>sort by </a:s>
                                 <a:s r="231">
                                    <a:s r="230">
                                       <a:s>start of </a:s>
                                       <a:s r="229">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
  	)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="235">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="236" locator="184:3-187:11" resultTypeName="t:DateTime" xsi:type="Start">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="235" locator="184:12-187:11" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="234" locator="184:12-187:4" resultTypeName="fhir:Encounter.Location" xsi:type="First">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <source localId="233" locator="185:8-186:28" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="228" locator="185:8-185:69" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="227" locator="185:8-185:52" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="226" locator="185:38-185:49" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <sort localId="232" locator="186:6-186:28">
                           <by localId="231" locator="186:14-186:28" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                              <expression localId="230" locator="186:14-186:28" resultTypeName="t:DateTime" xsi:type="Start">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="229" locator="186:23-186:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand name="period" xsi:type="IdentifierRef"/>
                                 </operand>
                              </expression>
                           </by>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="225" locator="183:57-183:65" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="250" locator="192:1-196:9" resultTypeName="t:DateTime" name="Hospital Departure Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="250">
               <a:s>/*
Returns the latest departure time for encounter including any prior ED visit. 
*/
define function &quot;Hospital Departure Time&quot;(TheEncounter </a:s>
               <a:s r="238">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s>):
	</a:s>
               <a:s r="249">
                  <a:s r="249">
                     <a:s>end of </a:s>
                     <a:s r="248">
                        <a:s r="247">
                           <a:s>Last(
	    </a:s>
                           <a:s r="246">
                              <a:s>
                                 <a:s r="241">
                                    <a:s r="240">
                                       <a:s>( </a:s>
                                       <a:s r="240">
                                          <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                          <a:s r="239">
                                             <a:s>TheEncounter</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s> )</a:s>
                                    </a:s>
                                    <a:s> HospitalLocation</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
			</a:s>
                              <a:s r="245">
                                 <a:s>sort by </a:s>
                                 <a:s r="244">
                                    <a:s r="243">
                                       <a:s>start of </a:s>
                                       <a:s r="242">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
	)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="248">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="249" locator="193:2-196:9" resultTypeName="t:DateTime" xsi:type="End">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="248" locator="193:9-196:9" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="247" locator="193:9-196:2" resultTypeName="fhir:Encounter.Location" xsi:type="Last">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <source localId="246" locator="194:6-195:26" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="241" locator="194:6-194:67" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="240" locator="194:6-194:50" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="239" locator="194:36-194:47" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <sort localId="245" locator="195:4-195:26">
                           <by localId="244" locator="195:12-195:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                              <expression localId="243" locator="195:12-195:26" resultTypeName="t:DateTime" xsi:type="Start">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="242" locator="195:21-195:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand name="period" xsi:type="IdentifierRef"/>
                                 </operand>
                              </expression>
                           </by>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="238" locator="192:56-192:64" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="263" locator="201:1-205:9" resultTypeName="t:DateTime" name="hospitalDepartureTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="263">
               <a:s>/*
Returns the latest departure time for encounter including any prior ED visit. 
*/
define fluent function hospitalDepartureTime(TheEncounter </a:s>
               <a:s r="251">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s>):
	</a:s>
               <a:s r="262">
                  <a:s r="262">
                     <a:s>end of </a:s>
                     <a:s r="261">
                        <a:s r="260">
                           <a:s>Last(
	    </a:s>
                           <a:s r="259">
                              <a:s>
                                 <a:s r="254">
                                    <a:s r="253">
                                       <a:s>( </a:s>
                                       <a:s r="253">
                                          <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                          <a:s r="252">
                                             <a:s>TheEncounter</a:s>
                                          </a:s>
                                          <a:s>)</a:s>
                                       </a:s>
                                       <a:s> )</a:s>
                                    </a:s>
                                    <a:s> HospitalLocation</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
			</a:s>
                              <a:s r="258">
                                 <a:s>sort by </a:s>
                                 <a:s r="257">
                                    <a:s r="256">
                                       <a:s>start of </a:s>
                                       <a:s r="255">
                                          <a:s>period</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>
	)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="261">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="262" locator="202:2-205:9" resultTypeName="t:DateTime" xsi:type="End">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="261" locator="202:9-205:9" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="260" locator="202:9-205:2" resultTypeName="fhir:Encounter.Location" xsi:type="Last">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <source localId="259" locator="203:6-204:26" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="254" locator="203:6-203:67" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="253" locator="203:6-203:50" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="252" locator="203:36-203:47" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <sort localId="258" locator="204:4-204:26">
                           <by localId="257" locator="204:12-204:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                              <expression localId="256" locator="204:12-204:26" resultTypeName="t:DateTime" xsi:type="Start">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="255" locator="204:21-204:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand name="period" xsi:type="IdentifierRef"/>
                                 </operand>
                              </expression>
                           </by>
                        </sort>
                     </source>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="251" locator="201:59-201:67" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="281" locator="383:1-386:3" resultTypeName="fhir:Location" name="GetLocation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="281">
               <a:s>/*
Returns the Location resource specified by the given reference
*/
define function &quot;GetLocation&quot;(reference </a:s>
               <a:s r="270">
                  <a:s>Reference</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="280">
                  <a:s r="280">
                     <a:s>singleton from </a:s>
                     <a:s r="279">
                        <a:s>(
    </a:s>
                        <a:s r="279">
                           <a:s>
                              <a:s r="272">
                                 <a:s r="271">
                                    <a:s r="271">
                                       <a:s>[Location]</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> L</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="278">
                              <a:s>where </a:s>
                              <a:s r="278">
                                 <a:s r="274">
                                    <a:s r="273">
                                       <a:s>L</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="274">
                                       <a:s>id</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="277">
                                    <a:s r="276">
                                       <a:s r="275">
                                          <a:s>reference</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="276">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="277">
                                       <a:s>getId()</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="280" locator="384:3-386:3" resultTypeName="fhir:Location" xsi:type="SingletonFrom">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="279" locator="384:18-386:3" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="272" locator="385:5-385:16" alias="L">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="271" locator="385:5-385:14" dataType="fhir:Location" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-location" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="278" locator="385:18-385:57" resultTypeName="t:Boolean" xsi:type="Equal">
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="274" locator="385:24-385:27" resultTypeName="t:String" path="value" xsi:type="Property">
                     <source path="id" scope="L" xsi:type="Property"/>
                  </operand>
                  <operand localId="277" locator="385:31-385:57" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="276" locator="385:31-385:49" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source path="reference" xsi:type="Property">
                           <source localId="275" locator="385:31-385:39" resultTypeName="fhir:Reference" name="reference" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand name="reference">
            <operandTypeSpecifier localId="270" locator="383:41-383:49" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="290" locator="207:1-213:9" resultTypeName="t:DateTime" name="Emergency Department Arrival Time" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="290">
               <a:s>define function &quot;Emergency Department Arrival Time&quot;(TheEncounter </a:s>
               <a:s r="264">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s>):
	</a:s>
               <a:s r="289">
                  <a:s r="289">
                     <a:s>start of </a:s>
                     <a:s r="288">
                        <a:s r="287">
                           <a:s>(
	    </a:s>
                           <a:s r="287">
                              <a:s>singleton from </a:s>
                              <a:s r="286">
                                 <a:s>(
	        </a:s>
                                 <a:s r="286">
                                    <a:s>
                                       <a:s r="267">
                                          <a:s r="266">
                                             <a:s>( </a:s>
                                             <a:s r="266">
                                                <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                                <a:s r="265">
                                                   <a:s>TheEncounter</a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s> )</a:s>
                                          </a:s>
                                          <a:s> HospitalLocation</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
				</a:s>
                                    <a:s r="285">
                                       <a:s>where </a:s>
                                       <a:s r="285">
                                          <a:s r="283">
                                             <a:s r="282">
                                                <a:s>GetLocation(</a:s>
                                                <a:s r="269">
                                                   <a:s r="268">
                                                      <a:s>HospitalLocation</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="269">
                                                      <a:s>location</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="283">
                                                <a:s>type</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> in </a:s>
                                          <a:s r="284">
                                             <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
		)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
	)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="288">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="289" locator="208:2-213:9" resultTypeName="t:DateTime" xsi:type="Start">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="288" locator="208:11-213:9" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="287" locator="208:11-213:2" resultTypeName="fhir:Encounter.Location" xsi:type="SingletonFrom">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="286" locator="209:21-212:3" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="267" locator="210:10-210:71" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="266" locator="210:10-210:54" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="265" locator="210:40-210:51" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <where localId="285" locator="211:5-211:85" resultTypeName="t:Boolean" xsi:type="AnyInValueSet">
                           <signature xsi:type="ListTypeSpecifier">
                              <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                           </signature>
                           <codes localId="283" locator="211:11-211:53" xsi:type="Query">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <source alias="$this">
                                 <expression path="type" xsi:type="Property">
                                    <source localId="282" locator="211:11-211:48" resultTypeName="fhir:Location" name="GetLocation" xsi:type="FunctionRef">
                                       <signature name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                       <operand localId="269" locator="211:23-211:47" resultTypeName="fhir:Reference" path="location" scope="HospitalLocation" xsi:type="Property"/>
                                    </source>
                                 </expression>
                              </source>
                              <return distinct="false">
                                 <expression name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <operand name="$this" xsi:type="AliasRef"/>
                                 </expression>
                              </return>
                           </codes>
                           <valueset localId="284" locator="211:58-211:85" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true"/>
                        </where>
                     </operand>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="264" locator="207:66-207:74" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="305" locator="215:1-221:9" resultTypeName="t:DateTime" name="emergencyDepartmentArrivalTime" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="305">
               <a:s>define fluent function emergencyDepartmentArrivalTime(TheEncounter </a:s>
               <a:s r="291">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s>):
	</a:s>
               <a:s r="304">
                  <a:s r="304">
                     <a:s>start of </a:s>
                     <a:s r="303">
                        <a:s r="302">
                           <a:s>(
	    </a:s>
                           <a:s r="302">
                              <a:s>singleton from </a:s>
                              <a:s r="301">
                                 <a:s>(
	        </a:s>
                                 <a:s r="301">
                                    <a:s>
                                       <a:s r="294">
                                          <a:s r="293">
                                             <a:s>( </a:s>
                                             <a:s r="293">
                                                <a:s>&quot;Hospitalization Locations&quot;(</a:s>
                                                <a:s r="292">
                                                   <a:s>TheEncounter</a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s> )</a:s>
                                          </a:s>
                                          <a:s> HospitalLocation</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>
				</a:s>
                                    <a:s r="300">
                                       <a:s>where </a:s>
                                       <a:s r="300">
                                          <a:s r="298">
                                             <a:s r="297">
                                                <a:s>GetLocation(</a:s>
                                                <a:s r="296">
                                                   <a:s r="295">
                                                      <a:s>HospitalLocation</a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="296">
                                                      <a:s>location</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>)</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="298">
                                                <a:s>type</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> in </a:s>
                                          <a:s r="299">
                                             <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
		)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
	)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="303">
                           <a:s>period</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="304" locator="216:2-221:9" resultTypeName="t:DateTime" xsi:type="Start">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="303" locator="216:11-221:9" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <operand path="period" xsi:type="Property">
                  <source localId="302" locator="216:11-221:2" resultTypeName="fhir:Encounter.Location" xsi:type="SingletonFrom">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="301" locator="217:21-220:3" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="294" locator="218:10-218:71" alias="HospitalLocation">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="293" locator="218:10-218:54" name="Hospitalization Locations" xsi:type="FunctionRef">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="292" locator="218:40-218:51" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
                           </expression>
                        </source>
                        <where localId="300" locator="219:5-219:85" resultTypeName="t:Boolean" xsi:type="AnyInValueSet">
                           <signature xsi:type="ListTypeSpecifier">
                              <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                           </signature>
                           <codes localId="298" locator="219:11-219:53" xsi:type="Query">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <source alias="$this">
                                 <expression path="type" xsi:type="Property">
                                    <source localId="297" locator="219:11-219:48" resultTypeName="fhir:Location" name="GetLocation" xsi:type="FunctionRef">
                                       <signature name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                       <operand localId="296" locator="219:23-219:47" resultTypeName="fhir:Reference" path="location" scope="HospitalLocation" xsi:type="Property"/>
                                    </source>
                                 </expression>
                              </source>
                              <return distinct="false">
                                 <expression name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <operand name="$this" xsi:type="AliasRef"/>
                                 </expression>
                              </return>
                           </codes>
                           <valueset localId="299" locator="219:58-219:85" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true"/>
                        </where>
                     </operand>
                  </source>
               </operand>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="291" locator="215:68-215:76" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="388" locator="226:1-244:107" name="HospitalizationWithObservationAndOutpatientSurgeryService" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="388">
               <a:s>/*
Hospitalization with Observation and Outpatient Surgery Service returns the total interval from the start of any immediately prior emergency department visit, outpatient surgery visit or observation visit to the discharge of the given encounter.
*/
define function &quot;HospitalizationWithObservationAndOutpatientSurgeryService&quot;(TheEncounter </a:s>
               <a:s r="306">
                  <a:s>&quot;Encounter&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="387">
                  <a:s r="387">
                     <a:s>
                        <a:s r="308">
                           <a:s r="307">
                              <a:s>
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                           </a:s>
                           <a:s> Visit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
	  </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="329">
                           <a:s>ObsVisit: </a:s>
                           <a:s r="328">
                              <a:s>Last(</a:s>
                              <a:s r="327">
                                 <a:s>
                                    <a:s r="310">
                                       <a:s r="309">
                                          <a:s r="309">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Observation Services&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastObs</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
		  	</a:s>
                                 <a:s r="322">
                                    <a:s>where </a:s>
                                    <a:s r="322">
                                       <a:s r="314">
                                          <a:s r="312">
                                             <a:s r="311">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="312">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="313">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
          and </a:s>
                                       <a:s r="321">
                                          <a:s r="316">
                                             <a:s r="315">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="316">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="321">
                                             <a:s>ends </a:s>
                                             <a:s r="320">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="319">
                                             <a:s>start of </a:s>
                                             <a:s r="318">
                                                <a:s r="317">
                                                   <a:s>Visit</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="318">
                                                   <a:s>period</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="326">
                                    <a:s>sort by	</a:s>
                                    <a:s r="325">
                                       <a:s r="324">
                                          <a:s>end of </a:s>
                                          <a:s r="323">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
    	)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    	</a:s>
                        <a:s r="337">
                           <a:s>VisitStart: </a:s>
                           <a:s r="336">
                              <a:s>Coalesce(</a:s>
                              <a:s r="332">
                                 <a:s>start of </a:s>
                                 <a:s r="331">
                                    <a:s r="330">
                                       <a:s>ObsVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="331">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="335">
                                 <a:s>start of </a:s>
                                 <a:s r="334">
                                    <a:s r="333">
                                       <a:s>Visit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="334">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    	</a:s>
                        <a:s r="356">
                           <a:s>EDVisit: </a:s>
                           <a:s r="355">
                              <a:s>Last(</a:s>
                              <a:s r="354">
                                 <a:s>
                                    <a:s r="339">
                                       <a:s r="338">
                                          <a:s r="338">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastED</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="349">
                                    <a:s>where </a:s>
                                    <a:s r="349">
                                       <a:s r="343">
                                          <a:s r="341">
                                             <a:s r="340">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="341">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="342">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
          and </a:s>
                                       <a:s r="348">
                                          <a:s r="345">
                                             <a:s r="344">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="345">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="348">
                                             <a:s>ends </a:s>
                                             <a:s r="347">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="346">
                                             <a:s>VisitStart</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="353">
                                    <a:s>sort by	</a:s>
                                    <a:s r="352">
                                       <a:s r="351">
                                          <a:s>end of </a:s>
                                          <a:s r="350">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
    	)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    	</a:s>
                        <a:s r="362">
                           <a:s>VisitStartWithED: </a:s>
                           <a:s r="361">
                              <a:s>Coalesce(</a:s>
                              <a:s r="359">
                                 <a:s>start of </a:s>
                                 <a:s r="358">
                                    <a:s r="357">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="358">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="360">
                                 <a:s>VisitStart</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    	</a:s>
                        <a:s r="376">
                           <a:s>OutpatientSurgeryVisit: </a:s>
                           <a:s r="375">
                              <a:s>Last(</a:s>
                              <a:s r="374">
                                 <a:s>
                                    <a:s r="364">
                                       <a:s r="363">
                                          <a:s r="363">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Outpatient Surgery Service&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastSurgeryOP</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="369">
                                    <a:s>where </a:s>
                                    <a:s r="369">
                                       <a:s r="366">
                                          <a:s r="365">
                                             <a:s>LastSurgeryOP</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="366">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="369">
                                          <a:s>ends </a:s>
                                          <a:s r="368">
                                             <a:s>1 hour</a:s>
                                          </a:s>
                                          <a:s> or less on or before</a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="367">
                                          <a:s>VisitStartWithED</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="373">
                                    <a:s>sort by	</a:s>
                                    <a:s r="372">
                                       <a:s r="371">
                                          <a:s>end of </a:s>
                                          <a:s r="370">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
    	)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  	</a:s>
                     <a:s r="386">
                        <a:s>return </a:s>
                        <a:s r="385">
                           <a:s>Interval[</a:s>
                           <a:s r="381">
                              <a:s>Coalesce(</a:s>
                              <a:s r="379">
                                 <a:s>start of </a:s>
                                 <a:s r="378">
                                    <a:s r="377">
                                       <a:s>OutpatientSurgeryVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="378">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="380">
                                 <a:s>VisitStartWithED</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="384">
                              <a:s>end of </a:s>
                              <a:s r="383">
                                 <a:s r="382">
                                    <a:s>Visit</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="383">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="387" locator="227:3-244:107" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="308" locator="227:3-227:20" resultTypeName="fhir:Encounter" alias="Visit">
               <expression localId="307" locator="227:3-227:14" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </source>
            <let localId="329" locator="228:8-232:6" resultTypeName="fhir:Encounter" identifier="ObsVisit">
               <expression localId="328" locator="228:18-232:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="327" locator="228:23-231:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="310" locator="228:23-228:65" alias="LastObs">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="309" locator="228:23-228:57" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="228:35-228:56" resultTypeName="t:ValueSet" name="Observation Services" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="322" locator="229:6-230:83" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="314" locator="229:12-229:38" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="312" locator="229:12-229:25" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastObs" xsi:type="Property"/>
                           </operand>
                           <operand localId="313" locator="229:29-229:38" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="321" locator="230:15-230:83" resultTypeName="t:Boolean" xsi:type="And">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="230:35-230:48" xsi:type="In">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand locator="230:30-230:33" xsi:type="End">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="316" locator="230:15-230:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastObs" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="230:35-230:48" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="230:63-230:83" xsi:type="Subtract">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="319" locator="230:63-230:83" resultTypeName="t:DateTime" xsi:type="Start">
                                       <signature xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </signature>
                                       <operand localId="318" locator="230:72-230:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="period" scope="Visit" xsi:type="Property"/>
                                       </operand>
                                    </operand>
                                    <operand localId="320" locator="230:35-230:40" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="319" locator="230:63-230:83" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="318" locator="230:72-230:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </high>
                              </operand>
                           </operand>
                           <operand locator="230:35-230:48" xsi:type="Not">
                              <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                              <operand locator="230:35-230:48" xsi:type="IsNull">
                                 <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="319" locator="230:63-230:83" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="318" locator="230:72-230:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="326" locator="231:6-231:26">
                        <by localId="325" locator="231:14-231:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="324" locator="231:14-231:26" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="323" locator="231:21-231:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="337" locator="233:6-233:74" resultTypeName="t:DateTime" identifier="VisitStart">
               <expression localId="336" locator="233:18-233:74" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="332" locator="233:27-233:50" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="331" locator="233:36-233:50" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="330" locator="233:36-233:43" resultTypeName="fhir:Encounter" name="ObsVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="335" locator="233:53-233:73" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="334" locator="233:62-233:73" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="356" locator="234:6-238:6" resultTypeName="fhir:Encounter" identifier="EDVisit">
               <expression localId="355" locator="234:15-238:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="354" locator="234:20-237:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="339" locator="234:20-234:67" alias="LastED">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="338" locator="234:20-234:60" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="234:32-234:59" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="349" locator="235:6-236:71" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="343" locator="235:12-235:37" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="341" locator="235:12-235:24" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastED" xsi:type="Property"/>
                           </operand>
                           <operand localId="342" locator="235:28-235:37" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="348" locator="236:15-236:71" resultTypeName="t:Boolean" xsi:type="And">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="236:34-236:47" xsi:type="In">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand locator="236:29-236:32" xsi:type="End">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="345" locator="236:15-236:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastED" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="236:34-236:47" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="236:62-236:71" xsi:type="Subtract">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="346" locator="236:62-236:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                                    <operand localId="347" locator="236:34-236:39" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="346" locator="236:62-236:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand locator="236:34-236:47" xsi:type="Not">
                              <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                              <operand locator="236:34-236:47" xsi:type="IsNull">
                                 <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="346" locator="236:62-236:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="353" locator="237:6-237:26">
                        <by localId="352" locator="237:14-237:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="351" locator="237:14-237:26" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="350" locator="237:21-237:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="362" locator="239:6-239:68" resultTypeName="t:DateTime" identifier="VisitStartWithED">
               <expression localId="361" locator="239:24-239:68" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="359" locator="239:33-239:55" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="358" locator="239:42-239:55" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="357" locator="239:42-239:48" resultTypeName="fhir:Encounter" name="EDVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="360" locator="239:58-239:67" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="376" locator="240:6-243:6" resultTypeName="fhir:Encounter" identifier="OutpatientSurgeryVisit">
               <expression localId="375" locator="240:30-243:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="374" locator="240:35-242:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="364" locator="240:35-240:89" alias="LastSurgeryOP">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="363" locator="240:35-240:75" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="240:47-240:74" resultTypeName="t:ValueSet" name="Outpatient Surgery Service" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="369" locator="241:6-241:81" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand locator="241:38-241:51" xsi:type="In">
                           <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           <signature xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </signature>
                           <operand locator="241:33-241:36" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="366" locator="241:12-241:31" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" scope="LastSurgeryOP" xsi:type="Property"/>
                              </operand>
                           </operand>
                           <operand locator="241:38-241:51" lowClosed="true" highClosed="true" xsi:type="Interval">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <low locator="241:66-241:81" xsi:type="Subtract">
                                 <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="367" locator="241:66-241:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                                 <operand localId="368" locator="241:38-241:43" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                              </low>
                              <high localId="367" locator="241:66-241:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                        <operand locator="241:38-241:51" xsi:type="Not">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="241:38-241:51" xsi:type="IsNull">
                              <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="367" locator="241:66-241:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="373" locator="242:6-242:26">
                        <by localId="372" locator="242:14-242:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="371" locator="242:14-242:26" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="370" locator="242:21-242:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <return localId="386" locator="244:4-244:107">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="385" locator="244:11-244:107" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low localId="381" locator="244:20-244:85" resultTypeName="t:DateTime" xsi:type="Coalesce">
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="379" locator="244:29-244:66" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="378" locator="244:38-244:66" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="377" locator="244:38-244:59" resultTypeName="fhir:Encounter" name="OutpatientSurgeryVisit" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="380" locator="244:69-244:84" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="384" locator="244:88-244:106" resultTypeName="t:DateTime" xsi:type="End">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="383" locator="244:95-244:106" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="306" locator="226:90-226:100" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="471" locator="249:1-267:107" name="hospitalizationWithObservationAndOutpatientSurgeryService" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="471">
               <a:s>/*
Hospitalization with Observation and Outpatient Surgery Service returns the total interval from the start of any immediately prior emergency department visit, outpatient surgery visit or observation visit to the discharge of the given encounter.
*/
define fluent function hospitalizationWithObservationAndOutpatientSurgeryService(TheEncounter </a:s>
               <a:s r="389">
                  <a:s>&quot;Encounter&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="470">
                  <a:s r="470">
                     <a:s>
                        <a:s r="391">
                           <a:s r="390">
                              <a:s>
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                           </a:s>
                           <a:s> Visit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
	  </a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="412">
                           <a:s>ObsVisit: </a:s>
                           <a:s r="411">
                              <a:s>Last(</a:s>
                              <a:s r="410">
                                 <a:s>
                                    <a:s r="393">
                                       <a:s r="392">
                                          <a:s r="392">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Observation Services&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastObs</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
		  	</a:s>
                                 <a:s r="405">
                                    <a:s>where </a:s>
                                    <a:s r="405">
                                       <a:s r="397">
                                          <a:s r="395">
                                             <a:s r="394">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="395">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="396">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
          and </a:s>
                                       <a:s r="404">
                                          <a:s r="399">
                                             <a:s r="398">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="399">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="404">
                                             <a:s>ends </a:s>
                                             <a:s r="403">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="402">
                                             <a:s>start of </a:s>
                                             <a:s r="401">
                                                <a:s r="400">
                                                   <a:s>Visit</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="401">
                                                   <a:s>period</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="409">
                                    <a:s>sort by	</a:s>
                                    <a:s r="408">
                                       <a:s r="407">
                                          <a:s>end of </a:s>
                                          <a:s r="406">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
    	)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    	</a:s>
                        <a:s r="420">
                           <a:s>VisitStart: </a:s>
                           <a:s r="419">
                              <a:s>Coalesce(</a:s>
                              <a:s r="415">
                                 <a:s>start of </a:s>
                                 <a:s r="414">
                                    <a:s r="413">
                                       <a:s>ObsVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="414">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="418">
                                 <a:s>start of </a:s>
                                 <a:s r="417">
                                    <a:s r="416">
                                       <a:s>Visit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="417">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    	</a:s>
                        <a:s r="439">
                           <a:s>EDVisit: </a:s>
                           <a:s r="438">
                              <a:s>Last(</a:s>
                              <a:s r="437">
                                 <a:s>
                                    <a:s r="422">
                                       <a:s r="421">
                                          <a:s r="421">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastED</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="432">
                                    <a:s>where </a:s>
                                    <a:s r="432">
                                       <a:s r="426">
                                          <a:s r="424">
                                             <a:s r="423">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="424">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="425">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
          and </a:s>
                                       <a:s r="431">
                                          <a:s r="428">
                                             <a:s r="427">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="428">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="431">
                                             <a:s>ends </a:s>
                                             <a:s r="430">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="429">
                                             <a:s>VisitStart</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="436">
                                    <a:s>sort by	</a:s>
                                    <a:s r="435">
                                       <a:s r="434">
                                          <a:s>end of </a:s>
                                          <a:s r="433">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
    	)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    	</a:s>
                        <a:s r="445">
                           <a:s>VisitStartWithED: </a:s>
                           <a:s r="444">
                              <a:s>Coalesce(</a:s>
                              <a:s r="442">
                                 <a:s>start of </a:s>
                                 <a:s r="441">
                                    <a:s r="440">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="441">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="443">
                                 <a:s>VisitStart</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
    	</a:s>
                        <a:s r="459">
                           <a:s>OutpatientSurgeryVisit: </a:s>
                           <a:s r="458">
                              <a:s>Last(</a:s>
                              <a:s r="457">
                                 <a:s>
                                    <a:s r="447">
                                       <a:s r="446">
                                          <a:s r="446">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Outpatient Surgery Service&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastSurgeryOP</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="452">
                                    <a:s>where </a:s>
                                    <a:s r="452">
                                       <a:s r="449">
                                          <a:s r="448">
                                             <a:s>LastSurgeryOP</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="449">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="452">
                                          <a:s>ends </a:s>
                                          <a:s r="451">
                                             <a:s>1 hour</a:s>
                                          </a:s>
                                          <a:s> or less on or before</a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="450">
                                          <a:s>VisitStartWithED</a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
			  </a:s>
                                 <a:s r="456">
                                    <a:s>sort by	</a:s>
                                    <a:s r="455">
                                       <a:s r="454">
                                          <a:s>end of </a:s>
                                          <a:s r="453">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
    	)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  	</a:s>
                     <a:s r="469">
                        <a:s>return </a:s>
                        <a:s r="468">
                           <a:s>Interval[</a:s>
                           <a:s r="464">
                              <a:s>Coalesce(</a:s>
                              <a:s r="462">
                                 <a:s>start of </a:s>
                                 <a:s r="461">
                                    <a:s r="460">
                                       <a:s>OutpatientSurgeryVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="461">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="463">
                                 <a:s>VisitStartWithED</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="467">
                              <a:s>end of </a:s>
                              <a:s r="466">
                                 <a:s r="465">
                                    <a:s>Visit</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="466">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="470" locator="250:3-267:107" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="391" locator="250:3-250:20" resultTypeName="fhir:Encounter" alias="Visit">
               <expression localId="390" locator="250:3-250:14" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </source>
            <let localId="412" locator="251:8-255:6" resultTypeName="fhir:Encounter" identifier="ObsVisit">
               <expression localId="411" locator="251:18-255:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="410" locator="251:23-254:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="393" locator="251:23-251:65" alias="LastObs">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="392" locator="251:23-251:57" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="251:35-251:56" resultTypeName="t:ValueSet" name="Observation Services" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="405" locator="252:6-253:83" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="397" locator="252:12-252:38" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="395" locator="252:12-252:25" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastObs" xsi:type="Property"/>
                           </operand>
                           <operand localId="396" locator="252:29-252:38" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="404" locator="253:15-253:83" resultTypeName="t:Boolean" xsi:type="And">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="253:35-253:48" xsi:type="In">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand locator="253:30-253:33" xsi:type="End">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="399" locator="253:15-253:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastObs" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="253:35-253:48" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="253:63-253:83" xsi:type="Subtract">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="402" locator="253:63-253:83" resultTypeName="t:DateTime" xsi:type="Start">
                                       <signature xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </signature>
                                       <operand localId="401" locator="253:72-253:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="period" scope="Visit" xsi:type="Property"/>
                                       </operand>
                                    </operand>
                                    <operand localId="403" locator="253:35-253:40" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="402" locator="253:63-253:83" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="401" locator="253:72-253:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </high>
                              </operand>
                           </operand>
                           <operand locator="253:35-253:48" xsi:type="Not">
                              <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                              <operand locator="253:35-253:48" xsi:type="IsNull">
                                 <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="402" locator="253:63-253:83" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="401" locator="253:72-253:83" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="409" locator="254:6-254:26">
                        <by localId="408" locator="254:14-254:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="407" locator="254:14-254:26" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="406" locator="254:21-254:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="420" locator="256:6-256:74" resultTypeName="t:DateTime" identifier="VisitStart">
               <expression localId="419" locator="256:18-256:74" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="415" locator="256:27-256:50" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="414" locator="256:36-256:50" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="413" locator="256:36-256:43" resultTypeName="fhir:Encounter" name="ObsVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="418" locator="256:53-256:73" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="417" locator="256:62-256:73" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="439" locator="257:6-261:6" resultTypeName="fhir:Encounter" identifier="EDVisit">
               <expression localId="438" locator="257:15-261:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="437" locator="257:20-260:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="422" locator="257:20-257:67" alias="LastED">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="421" locator="257:20-257:60" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="257:32-257:59" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="432" locator="258:6-259:71" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="426" locator="258:12-258:37" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="424" locator="258:12-258:24" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastED" xsi:type="Property"/>
                           </operand>
                           <operand localId="425" locator="258:28-258:37" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="431" locator="259:15-259:71" resultTypeName="t:Boolean" xsi:type="And">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="259:34-259:47" xsi:type="In">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand locator="259:29-259:32" xsi:type="End">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="428" locator="259:15-259:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastED" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="259:34-259:47" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="259:62-259:71" xsi:type="Subtract">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="429" locator="259:62-259:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                                    <operand localId="430" locator="259:34-259:39" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="429" locator="259:62-259:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand locator="259:34-259:47" xsi:type="Not">
                              <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                              <operand locator="259:34-259:47" xsi:type="IsNull">
                                 <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="429" locator="259:62-259:71" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="436" locator="260:6-260:26">
                        <by localId="435" locator="260:14-260:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="434" locator="260:14-260:26" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="433" locator="260:21-260:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="445" locator="262:6-262:68" resultTypeName="t:DateTime" identifier="VisitStartWithED">
               <expression localId="444" locator="262:24-262:68" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="442" locator="262:33-262:55" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="441" locator="262:42-262:55" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="440" locator="262:42-262:48" resultTypeName="fhir:Encounter" name="EDVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="443" locator="262:58-262:67" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
               </expression>
            </let>
            <let localId="459" locator="263:6-266:6" resultTypeName="fhir:Encounter" identifier="OutpatientSurgeryVisit">
               <expression localId="458" locator="263:30-266:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="457" locator="263:35-265:26" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="447" locator="263:35-263:89" alias="LastSurgeryOP">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="446" locator="263:35-263:75" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="263:47-263:74" resultTypeName="t:ValueSet" name="Outpatient Surgery Service" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="452" locator="264:6-264:81" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand locator="264:38-264:51" xsi:type="In">
                           <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           <signature xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </signature>
                           <operand locator="264:33-264:36" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="449" locator="264:12-264:31" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand path="period" scope="LastSurgeryOP" xsi:type="Property"/>
                              </operand>
                           </operand>
                           <operand locator="264:38-264:51" lowClosed="true" highClosed="true" xsi:type="Interval">
                              <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                              <low locator="264:66-264:81" xsi:type="Subtract">
                                 <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="450" locator="264:66-264:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                                 <operand localId="451" locator="264:38-264:43" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                              </low>
                              <high localId="450" locator="264:66-264:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                        <operand locator="264:38-264:51" xsi:type="Not">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="264:38-264:51" xsi:type="IsNull">
                              <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="450" locator="264:66-264:81" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="456" locator="265:6-265:26">
                        <by localId="455" locator="265:14-265:26" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="454" locator="265:14-265:26" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="453" locator="265:21-265:26" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <return localId="469" locator="267:4-267:107">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="468" locator="267:11-267:107" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low localId="464" locator="267:20-267:85" resultTypeName="t:DateTime" xsi:type="Coalesce">
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="462" locator="267:29-267:66" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="461" locator="267:38-267:66" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="460" locator="267:38-267:59" resultTypeName="fhir:Encounter" name="OutpatientSurgeryVisit" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="463" locator="267:69-267:84" resultTypeName="t:DateTime" name="VisitStartWithED" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="467" locator="267:88-267:106" resultTypeName="t:DateTime" xsi:type="End">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="466" locator="267:95-267:106" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="389" locator="249:95-249:105" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="534" locator="272:1-285:87" name="HospitalizationWithObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="534">
               <a:s>/*
Hospitalization with Observation returns the total interval from the start of any immediately prior emergency department visit through the observation visit to the discharge of the given encounter
*/
define function &quot;HospitalizationWithObservation&quot;(TheEncounter </a:s>
               <a:s r="472">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="533">
                  <a:s r="533">
                     <a:s>
                        <a:s r="474">
                           <a:s r="473">
                              <a:s>
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                           </a:s>
                           <a:s> Visit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  		</a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="495">
                           <a:s>ObsVisit: </a:s>
                           <a:s r="494">
                              <a:s>Last(</a:s>
                              <a:s r="493">
                                 <a:s>
                                    <a:s r="476">
                                       <a:s r="475">
                                          <a:s r="475">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Observation Services&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastObs</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
  				</a:s>
                                 <a:s r="488">
                                    <a:s>where </a:s>
                                    <a:s r="488">
                                       <a:s r="480">
                                          <a:s r="478">
                                             <a:s r="477">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="478">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="479">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
            and </a:s>
                                       <a:s r="487">
                                          <a:s r="482">
                                             <a:s r="481">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="482">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="487">
                                             <a:s>ends </a:s>
                                             <a:s r="486">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="485">
                                             <a:s>start of </a:s>
                                             <a:s r="484">
                                                <a:s r="483">
                                                   <a:s>Visit</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="484">
                                                   <a:s>period</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
  				</a:s>
                                 <a:s r="492">
                                    <a:s>sort by </a:s>
                                    <a:s r="491">
                                       <a:s r="490">
                                          <a:s>end of </a:s>
                                          <a:s r="489">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
  			)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
  			</a:s>
                        <a:s r="503">
                           <a:s>VisitStart: </a:s>
                           <a:s r="502">
                              <a:s>Coalesce(</a:s>
                              <a:s r="498">
                                 <a:s>start of </a:s>
                                 <a:s r="497">
                                    <a:s r="496">
                                       <a:s>ObsVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="497">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="501">
                                 <a:s>start of </a:s>
                                 <a:s r="500">
                                    <a:s r="499">
                                       <a:s>Visit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="500">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
  			</a:s>
                        <a:s r="522">
                           <a:s>EDVisit: </a:s>
                           <a:s r="521">
                              <a:s>Last(</a:s>
                              <a:s r="520">
                                 <a:s>
                                    <a:s r="505">
                                       <a:s r="504">
                                          <a:s r="504">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastED</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
  				</a:s>
                                 <a:s r="515">
                                    <a:s>where </a:s>
                                    <a:s r="515">
                                       <a:s r="509">
                                          <a:s r="507">
                                             <a:s r="506">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="507">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="508">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
            and </a:s>
                                       <a:s r="514">
                                          <a:s r="511">
                                             <a:s r="510">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="511">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="514">
                                             <a:s>ends </a:s>
                                             <a:s r="513">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="512">
                                             <a:s>VisitStart</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
  				</a:s>
                                 <a:s r="519">
                                    <a:s>sort by </a:s>
                                    <a:s r="518">
                                       <a:s r="517">
                                          <a:s>end of </a:s>
                                          <a:s r="516">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
  			)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  		</a:s>
                     <a:s r="532">
                        <a:s>return </a:s>
                        <a:s r="531">
                           <a:s>Interval[</a:s>
                           <a:s r="527">
                              <a:s>Coalesce(</a:s>
                              <a:s r="525">
                                 <a:s>start of </a:s>
                                 <a:s r="524">
                                    <a:s r="523">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="524">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="526">
                                 <a:s>VisitStart</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="530">
                              <a:s>end of </a:s>
                              <a:s r="529">
                                 <a:s r="528">
                                    <a:s>Visit</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="529">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="533" locator="273:3-285:87" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="474" locator="273:3-273:20" resultTypeName="fhir:Encounter" alias="Visit">
               <expression localId="473" locator="273:3-273:14" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </source>
            <let localId="495" locator="274:9-278:6" resultTypeName="fhir:Encounter" identifier="ObsVisit">
               <expression localId="494" locator="274:19-278:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="493" locator="274:24-277:27" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="476" locator="274:24-274:66" alias="LastObs">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="475" locator="274:24-274:58" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="274:36-274:57" resultTypeName="t:ValueSet" name="Observation Services" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="488" locator="275:7-276:85" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="480" locator="275:13-275:39" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="478" locator="275:13-275:26" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastObs" xsi:type="Property"/>
                           </operand>
                           <operand localId="479" locator="275:30-275:39" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="487" locator="276:17-276:85" resultTypeName="t:Boolean" xsi:type="And">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="276:37-276:50" xsi:type="In">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand locator="276:32-276:35" xsi:type="End">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="482" locator="276:17-276:30" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastObs" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="276:37-276:50" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="276:65-276:85" xsi:type="Subtract">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="485" locator="276:65-276:85" resultTypeName="t:DateTime" xsi:type="Start">
                                       <signature xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </signature>
                                       <operand localId="484" locator="276:74-276:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="period" scope="Visit" xsi:type="Property"/>
                                       </operand>
                                    </operand>
                                    <operand localId="486" locator="276:37-276:42" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="485" locator="276:65-276:85" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="484" locator="276:74-276:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </high>
                              </operand>
                           </operand>
                           <operand locator="276:37-276:50" xsi:type="Not">
                              <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                              <operand locator="276:37-276:50" xsi:type="IsNull">
                                 <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="485" locator="276:65-276:85" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="484" locator="276:74-276:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="492" locator="277:7-277:27">
                        <by localId="491" locator="277:15-277:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="490" locator="277:15-277:27" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="489" locator="277:22-277:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="503" locator="279:6-279:74" resultTypeName="t:DateTime" identifier="VisitStart">
               <expression localId="502" locator="279:18-279:74" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="498" locator="279:27-279:50" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="497" locator="279:36-279:50" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="496" locator="279:36-279:43" resultTypeName="fhir:Encounter" name="ObsVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="501" locator="279:53-279:73" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="500" locator="279:62-279:73" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="522" locator="280:6-284:6" resultTypeName="fhir:Encounter" identifier="EDVisit">
               <expression localId="521" locator="280:15-284:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="520" locator="280:20-283:27" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="505" locator="280:20-280:67" alias="LastED">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="504" locator="280:20-280:60" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="280:32-280:59" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="515" locator="281:7-282:73" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="509" locator="281:13-281:38" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="507" locator="281:13-281:25" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastED" xsi:type="Property"/>
                           </operand>
                           <operand localId="508" locator="281:29-281:38" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="514" locator="282:17-282:73" resultTypeName="t:Boolean" xsi:type="And">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="282:36-282:49" xsi:type="In">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand locator="282:31-282:34" xsi:type="End">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="511" locator="282:17-282:29" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastED" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="282:36-282:49" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="282:64-282:73" xsi:type="Subtract">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="512" locator="282:64-282:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                                    <operand localId="513" locator="282:36-282:41" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="512" locator="282:64-282:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand locator="282:36-282:49" xsi:type="Not">
                              <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                              <operand locator="282:36-282:49" xsi:type="IsNull">
                                 <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="512" locator="282:64-282:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="519" locator="283:7-283:27">
                        <by localId="518" locator="283:15-283:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="517" locator="283:15-283:27" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="516" locator="283:22-283:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <return localId="532" locator="285:5-285:87">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="531" locator="285:12-285:87" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low localId="527" locator="285:21-285:65" resultTypeName="t:DateTime" xsi:type="Coalesce">
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="525" locator="285:30-285:52" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="524" locator="285:39-285:52" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="523" locator="285:39-285:45" resultTypeName="fhir:Encounter" name="EDVisit" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="526" locator="285:55-285:64" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="530" locator="285:68-285:86" resultTypeName="t:DateTime" xsi:type="End">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="529" locator="285:75-285:86" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="472" locator="272:63-272:71" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="597" locator="290:1-303:87" name="hospitalizationWithObservation" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="597">
               <a:s>/*
Hospitalization with Observation returns the total interval from the start of any immediately prior emergency department visit through the observation visit to the discharge of the given encounter
*/
define fluent function hospitalizationWithObservation(TheEncounter </a:s>
               <a:s r="535">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="596">
                  <a:s r="596">
                     <a:s>
                        <a:s r="537">
                           <a:s r="536">
                              <a:s>
                                 <a:s>TheEncounter</a:s>
                              </a:s>
                           </a:s>
                           <a:s> Visit</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  		</a:s>
                     <a:s>
                        <a:s>let </a:s>
                        <a:s r="558">
                           <a:s>ObsVisit: </a:s>
                           <a:s r="557">
                              <a:s>Last(</a:s>
                              <a:s r="556">
                                 <a:s>
                                    <a:s r="539">
                                       <a:s r="538">
                                          <a:s r="538">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Observation Services&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastObs</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
  				</a:s>
                                 <a:s r="551">
                                    <a:s>where </a:s>
                                    <a:s r="551">
                                       <a:s r="543">
                                          <a:s r="541">
                                             <a:s r="540">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="541">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="542">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
            and </a:s>
                                       <a:s r="550">
                                          <a:s r="545">
                                             <a:s r="544">
                                                <a:s>LastObs</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="545">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="550">
                                             <a:s>ends </a:s>
                                             <a:s r="549">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="548">
                                             <a:s>start of </a:s>
                                             <a:s r="547">
                                                <a:s r="546">
                                                   <a:s>Visit</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="547">
                                                   <a:s>period</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
  				</a:s>
                                 <a:s r="555">
                                    <a:s>sort by </a:s>
                                    <a:s r="554">
                                       <a:s r="553">
                                          <a:s>end of </a:s>
                                          <a:s r="552">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
  			)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
  			</a:s>
                        <a:s r="566">
                           <a:s>VisitStart: </a:s>
                           <a:s r="565">
                              <a:s>Coalesce(</a:s>
                              <a:s r="561">
                                 <a:s>start of </a:s>
                                 <a:s r="560">
                                    <a:s r="559">
                                       <a:s>ObsVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="560">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="564">
                                 <a:s>start of </a:s>
                                 <a:s r="563">
                                    <a:s r="562">
                                       <a:s>Visit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="563">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                        <a:s>,
  			</a:s>
                        <a:s r="585">
                           <a:s>EDVisit: </a:s>
                           <a:s r="584">
                              <a:s>Last(</a:s>
                              <a:s r="583">
                                 <a:s>
                                    <a:s r="568">
                                       <a:s r="567">
                                          <a:s r="567">
                                             <a:s>[Encounter: </a:s>
                                             <a:s>
                                                <a:s>&quot;Emergency Department Visit&quot;</a:s>
                                             </a:s>
                                             <a:s>]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> LastED</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
  				</a:s>
                                 <a:s r="578">
                                    <a:s>where </a:s>
                                    <a:s r="578">
                                       <a:s r="572">
                                          <a:s r="570">
                                             <a:s r="569">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="570">
                                                <a:s>status</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="571">
                                             <a:s>'finished'</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>
            and </a:s>
                                       <a:s r="577">
                                          <a:s r="574">
                                             <a:s r="573">
                                                <a:s>LastED</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="574">
                                                <a:s>period</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="577">
                                             <a:s>ends </a:s>
                                             <a:s r="576">
                                                <a:s>1 hour</a:s>
                                             </a:s>
                                             <a:s> or less on or before</a:s>
                                          </a:s>
                                          <a:s> </a:s>
                                          <a:s r="575">
                                             <a:s>VisitStart</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>
  				</a:s>
                                 <a:s r="582">
                                    <a:s>sort by </a:s>
                                    <a:s r="581">
                                       <a:s r="580">
                                          <a:s>end of </a:s>
                                          <a:s r="579">
                                             <a:s>period</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
  			)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  		</a:s>
                     <a:s r="595">
                        <a:s>return </a:s>
                        <a:s r="594">
                           <a:s>Interval[</a:s>
                           <a:s r="590">
                              <a:s>Coalesce(</a:s>
                              <a:s r="588">
                                 <a:s>start of </a:s>
                                 <a:s r="587">
                                    <a:s r="586">
                                       <a:s>EDVisit</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="587">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>, </a:s>
                              <a:s r="589">
                                 <a:s>VisitStart</a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                           <a:s>, </a:s>
                           <a:s r="593">
                              <a:s>end of </a:s>
                              <a:s r="592">
                                 <a:s r="591">
                                    <a:s>Visit</a:s>
                                 </a:s>
                                 <a:s>.</a:s>
                                 <a:s r="592">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                           <a:s>]</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
            <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="596" locator="291:3-303:87" xsi:type="Query">
            <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="537" locator="291:3-291:20" resultTypeName="fhir:Encounter" alias="Visit">
               <expression localId="536" locator="291:3-291:14" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </source>
            <let localId="558" locator="292:9-296:6" resultTypeName="fhir:Encounter" identifier="ObsVisit">
               <expression localId="557" locator="292:19-296:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="556" locator="292:24-295:27" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="539" locator="292:24-292:66" alias="LastObs">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="538" locator="292:24-292:58" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="292:36-292:57" resultTypeName="t:ValueSet" name="Observation Services" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="551" locator="293:7-294:85" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="543" locator="293:13-293:39" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="541" locator="293:13-293:26" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastObs" xsi:type="Property"/>
                           </operand>
                           <operand localId="542" locator="293:30-293:39" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="550" locator="294:17-294:85" resultTypeName="t:Boolean" xsi:type="And">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="294:37-294:50" xsi:type="In">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand locator="294:32-294:35" xsi:type="End">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="545" locator="294:17-294:30" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastObs" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="294:37-294:50" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="294:65-294:85" xsi:type="Subtract">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="548" locator="294:65-294:85" resultTypeName="t:DateTime" xsi:type="Start">
                                       <signature xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </signature>
                                       <operand localId="547" locator="294:74-294:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                             <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="period" scope="Visit" xsi:type="Property"/>
                                       </operand>
                                    </operand>
                                    <operand localId="549" locator="294:37-294:42" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="548" locator="294:65-294:85" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="547" locator="294:74-294:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </high>
                              </operand>
                           </operand>
                           <operand locator="294:37-294:50" xsi:type="Not">
                              <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                              <operand locator="294:37-294:50" xsi:type="IsNull">
                                 <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="548" locator="294:65-294:85" resultTypeName="t:DateTime" xsi:type="Start">
                                    <signature xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </signature>
                                    <operand localId="547" locator="294:74-294:85" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                       <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                          <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                       </resultTypeSpecifier>
                                       <operand path="period" scope="Visit" xsi:type="Property"/>
                                    </operand>
                                 </operand>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="555" locator="295:7-295:27">
                        <by localId="554" locator="295:15-295:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="553" locator="295:15-295:27" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="552" locator="295:22-295:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <let localId="566" locator="297:6-297:74" resultTypeName="t:DateTime" identifier="VisitStart">
               <expression localId="565" locator="297:18-297:74" resultTypeName="t:DateTime" xsi:type="Coalesce">
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="561" locator="297:27-297:50" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="560" locator="297:36-297:50" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="559" locator="297:36-297:43" resultTypeName="fhir:Encounter" name="ObsVisit" xsi:type="QueryLetRef"/>
                        </operand>
                     </operand>
                  </operand>
                  <operand localId="564" locator="297:53-297:73" resultTypeName="t:DateTime" xsi:type="Start">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="563" locator="297:62-297:73" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </operand>
               </expression>
            </let>
            <let localId="585" locator="298:6-302:6" resultTypeName="fhir:Encounter" identifier="EDVisit">
               <expression localId="584" locator="298:15-302:6" resultTypeName="fhir:Encounter" xsi:type="Last">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <source localId="583" locator="298:20-301:27" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="568" locator="298:20-298:67" alias="LastED">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="567" locator="298:20-298:60" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-encounter" codeProperty="type" codeComparator="in" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <codes locator="298:32-298:59" resultTypeName="t:ValueSet" name="Emergency Department Visit" preserve="true" xsi:type="ValueSetRef"/>
                        </expression>
                     </source>
                     <where localId="578" locator="299:7-300:73" resultTypeName="t:Boolean" xsi:type="And">
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="572" locator="299:13-299:38" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="570" locator="299:13-299:25" resultTypeName="fhir:EncounterStatus" path="value" xsi:type="Property">
                              <source path="status" scope="LastED" xsi:type="Property"/>
                           </operand>
                           <operand localId="571" locator="299:29-299:38" resultTypeName="t:String" valueType="t:String" value="finished" xsi:type="Literal"/>
                        </operand>
                        <operand localId="577" locator="300:17-300:73" resultTypeName="t:Boolean" xsi:type="And">
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                           <operand locator="300:36-300:49" xsi:type="In">
                              <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand locator="300:31-300:34" xsi:type="End">
                                 <signature xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </signature>
                                 <operand localId="574" locator="300:17-300:29" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                    <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                       <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    </resultTypeSpecifier>
                                    <operand path="period" scope="LastED" xsi:type="Property"/>
                                 </operand>
                              </operand>
                              <operand locator="300:36-300:49" lowClosed="true" highClosed="true" xsi:type="Interval">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <low locator="300:64-300:73" xsi:type="Subtract">
                                    <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                    <signature name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
                                    <operand localId="575" locator="300:64-300:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                                    <operand localId="576" locator="300:36-300:41" resultTypeName="t:Quantity" value="1" unit="hour" xsi:type="Quantity"/>
                                 </low>
                                 <high localId="575" locator="300:64-300:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                           <operand locator="300:36-300:49" xsi:type="Not">
                              <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                              <operand locator="300:36-300:49" xsi:type="IsNull">
                                 <signature name="t:Any" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="575" locator="300:64-300:73" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                              </operand>
                           </operand>
                        </operand>
                     </where>
                     <sort localId="582" locator="301:7-301:27">
                        <by localId="581" locator="301:15-301:27" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                           <expression localId="580" locator="301:15-301:27" resultTypeName="t:DateTime" xsi:type="End">
                              <signature xsi:type="IntervalTypeSpecifier">
                                 <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                              </signature>
                              <operand localId="579" locator="301:22-301:27" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                 <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                                    <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                                 </resultTypeSpecifier>
                                 <operand name="period" xsi:type="IdentifierRef"/>
                              </operand>
                           </expression>
                        </by>
                     </sort>
                  </source>
               </expression>
            </let>
            <return localId="595" locator="303:5-303:87">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="594" locator="303:12-303:87" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                     <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <low localId="590" locator="303:21-303:65" resultTypeName="t:DateTime" xsi:type="Coalesce">
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <signature name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="588" locator="303:30-303:52" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="587" locator="303:39-303:52" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand path="period" xsi:type="Property">
                              <source localId="586" locator="303:39-303:45" resultTypeName="fhir:Encounter" name="EDVisit" xsi:type="QueryLetRef"/>
                           </operand>
                        </operand>
                     </operand>
                     <operand localId="589" locator="303:55-303:64" resultTypeName="t:DateTime" name="VisitStart" xsi:type="QueryLetRef"/>
                  </low>
                  <high localId="593" locator="303:68-303:86" resultTypeName="t:DateTime" xsi:type="End">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="592" locator="303:75-303:86" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="Visit" xsi:type="Property"/>
                     </operand>
                  </high>
               </expression>
            </return>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="535" locator="290:68-290:76" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="602" locator="308:1-309:64" resultTypeName="t:Integer" name="HospitalizationWithObservationLengthofStay" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="602">
               <a:s>/*
Hospitalization with Observation Length of Stay returns the length in days from the start of any immediately prior emergency department visit through the observation visit to the discharge of the given encounter
*/
define function &quot;HospitalizationWithObservationLengthofStay&quot;(TheEncounter </a:s>
               <a:s r="598">
                  <a:s>&quot;Encounter&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="601">
                  <a:s r="601">
                     <a:s>&quot;LengthInDays&quot;(</a:s>
                     <a:s r="600">
                        <a:s>&quot;HospitalizationWithObservation&quot;(</a:s>
                        <a:s r="599">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="601" locator="309:3-309:64" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="600" locator="309:18-309:63" name="HospitalizationWithObservation" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               <operand localId="599" locator="309:51-309:62" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="598" locator="308:75-308:85" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="607" locator="314:1-315:64" resultTypeName="t:Integer" name="hospitalizationWithObservationLengthofStay" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="607">
               <a:s>/*
Hospitalization with Observation Length of Stay returns the length in days from the start of any immediately prior emergency department visit through the observation visit to the discharge of the given encounter
*/
define fluent function hospitalizationWithObservationLengthofStay(TheEncounter </a:s>
               <a:s r="603">
                  <a:s>&quot;Encounter&quot;</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="606">
                  <a:s r="606">
                     <a:s>&quot;LengthInDays&quot;(</a:s>
                     <a:s r="605">
                        <a:s>&quot;HospitalizationWithObservation&quot;(</a:s>
                        <a:s r="604">
                           <a:s>TheEncounter</a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                     <a:s>)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="606" locator="315:3-315:64" resultTypeName="t:Integer" name="LengthInDays" xsi:type="FunctionRef">
            <signature xsi:type="IntervalTypeSpecifier">
               <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="605" locator="315:18-315:63" name="HospitalizationWithObservation" xsi:type="FunctionRef">
               <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <signature name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
               <operand localId="604" locator="315:51-315:62" resultTypeName="fhir:Encounter" name="TheEncounter" xsi:type="OperandRef"/>
            </operand>
         </expression>
         <operand name="TheEncounter">
            <operandTypeSpecifier localId="603" locator="314:80-314:90" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="630" locator="320:1-325:4" resultTypeName="fhir:Encounter.Location" name="FirstInpatientIntensiveCareUnit" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="630">
               <a:s>/*
First Inpatient Intensive Care Unit returns the first intensive care unit for the given encounter, without considering any immediately prior emergency department visit.
*/
define function &quot;FirstInpatientIntensiveCareUnit&quot;(Encounter </a:s>
               <a:s r="608">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="629">
                  <a:s r="629">
                     <a:s>First(</a:s>
                     <a:s r="628">
                        <a:s>
                           <a:s r="611">
                              <a:s r="610">
                                 <a:s>(</a:s>
                                 <a:s r="610">
                                    <a:s r="609">
                                       <a:s>Encounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="610">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>HospitalLocation</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  			</a:s>
                        <a:s r="623">
                           <a:s>where </a:s>
                           <a:s r="623">
                              <a:s r="617">
                                 <a:s r="615">
                                    <a:s r="614">
                                       <a:s>GetLocation(</a:s>
                                       <a:s r="613">
                                          <a:s r="612">
                                             <a:s>HospitalLocation</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="613">
                                             <a:s>location</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="615">
                                       <a:s>type</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> in </a:s>
                                 <a:s r="616">
                                    <a:s>&quot;Intensive Care Unit&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
  				and </a:s>
                              <a:s r="622">
                                 <a:s r="619">
                                    <a:s r="618">
                                       <a:s>HospitalLocation</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="619">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="622"> during </a:s>
                                 <a:s r="621">
                                    <a:s r="620">
                                       <a:s>Encounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="621">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  			</a:s>
                        <a:s r="627">
                           <a:s>sort by </a:s>
                           <a:s r="626">
                              <a:s r="625">
                                 <a:s>start of </a:s>
                                 <a:s r="624">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  	)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="629" locator="321:3-325:4" resultTypeName="fhir:Encounter.Location" xsi:type="First">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <source localId="628" locator="321:9-324:28" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="611" locator="321:9-321:44" alias="HospitalLocation">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="610" locator="321:9-321:28" path="location" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="609" locator="321:10-321:18" resultTypeName="fhir:Encounter" name="Encounter" xsi:type="OperandRef"/>
                  </expression>
               </source>
               <where localId="623" locator="322:6-323:57" resultTypeName="t:Boolean" xsi:type="And">
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="617" locator="322:12-322:79" resultTypeName="t:Boolean" xsi:type="AnyInValueSet">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <codes localId="615" locator="322:12-322:54" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source alias="$this">
                           <expression path="type" xsi:type="Property">
                              <source localId="614" locator="322:12-322:49" resultTypeName="fhir:Location" name="GetLocation" xsi:type="FunctionRef">
                                 <signature name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="613" locator="322:24-322:48" resultTypeName="fhir:Reference" path="location" scope="HospitalLocation" xsi:type="Property"/>
                              </source>
                           </expression>
                        </source>
                        <return distinct="false">
                           <expression name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <operand name="$this" xsi:type="AliasRef"/>
                           </expression>
                        </return>
                     </codes>
                     <valueset localId="616" locator="322:59-322:79" resultTypeName="t:ValueSet" name="Intensive Care Unit" preserve="true"/>
                  </operand>
                  <operand localId="622" locator="323:11-323:57" resultTypeName="t:Boolean" xsi:type="IncludedIn">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="619" locator="323:11-323:33" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="HospitalLocation" xsi:type="Property"/>
                     </operand>
                     <operand localId="621" locator="323:42-323:57" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="620" locator="323:42-323:50" resultTypeName="fhir:Encounter" name="Encounter" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <sort localId="627" locator="324:6-324:28">
                  <by localId="626" locator="324:14-324:28" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                     <expression localId="625" locator="324:14-324:28" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="624" locator="324:23-324:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="608" locator="320:61-320:69" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="653" locator="330:1-335:4" resultTypeName="fhir:Encounter.Location" name="firstInpatientIntensiveCareUnit" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="653">
               <a:s>/*
First Inpatient Intensive Care Unit returns the first intensive care unit for the given encounter, without considering any immediately prior emergency department visit.
*/
define fluent function firstInpatientIntensiveCareUnit(Encounter </a:s>
               <a:s r="631">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="652">
                  <a:s r="652">
                     <a:s>First(</a:s>
                     <a:s r="651">
                        <a:s>
                           <a:s r="634">
                              <a:s r="633">
                                 <a:s>(</a:s>
                                 <a:s r="633">
                                    <a:s r="632">
                                       <a:s>Encounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="633">
                                       <a:s>location</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                              <a:s>HospitalLocation</a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  			</a:s>
                        <a:s r="646">
                           <a:s>where </a:s>
                           <a:s r="646">
                              <a:s r="640">
                                 <a:s r="638">
                                    <a:s r="637">
                                       <a:s>GetLocation(</a:s>
                                       <a:s r="636">
                                          <a:s r="635">
                                             <a:s>HospitalLocation</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="636">
                                             <a:s>location</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s>)</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="638">
                                       <a:s>type</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> in </a:s>
                                 <a:s r="639">
                                    <a:s>&quot;Intensive Care Unit&quot;</a:s>
                                 </a:s>
                              </a:s>
                              <a:s>
  				and </a:s>
                              <a:s r="645">
                                 <a:s r="642">
                                    <a:s r="641">
                                       <a:s>HospitalLocation</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="642">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s r="645"> during </a:s>
                                 <a:s r="644">
                                    <a:s r="643">
                                       <a:s>Encounter</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="644">
                                       <a:s>period</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  			</a:s>
                        <a:s r="650">
                           <a:s>sort by </a:s>
                           <a:s r="649">
                              <a:s r="648">
                                 <a:s>start of </a:s>
                                 <a:s r="647">
                                    <a:s>period</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  	)</a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="652" locator="331:3-335:4" resultTypeName="fhir:Encounter.Location" xsi:type="First">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <source localId="651" locator="331:9-334:28" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="634" locator="331:9-331:44" alias="HospitalLocation">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="633" locator="331:9-331:28" path="location" xsi:type="Property">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="632" locator="331:10-331:18" resultTypeName="fhir:Encounter" name="Encounter" xsi:type="OperandRef"/>
                  </expression>
               </source>
               <where localId="646" locator="332:6-333:57" resultTypeName="t:Boolean" xsi:type="And">
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:Boolean" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="640" locator="332:12-332:79" resultTypeName="t:Boolean" xsi:type="AnyInValueSet">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <codes localId="638" locator="332:12-332:54" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source alias="$this">
                           <expression path="type" xsi:type="Property">
                              <source localId="637" locator="332:12-332:49" resultTypeName="fhir:Location" name="GetLocation" xsi:type="FunctionRef">
                                 <signature name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                 <operand localId="636" locator="332:24-332:48" resultTypeName="fhir:Reference" path="location" scope="HospitalLocation" xsi:type="Property"/>
                              </source>
                           </expression>
                        </source>
                        <return distinct="false">
                           <expression name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                              <operand name="$this" xsi:type="AliasRef"/>
                           </expression>
                        </return>
                     </codes>
                     <valueset localId="639" locator="332:59-332:79" resultTypeName="t:ValueSet" name="Intensive Care Unit" preserve="true"/>
                  </operand>
                  <operand localId="645" locator="333:11-333:57" resultTypeName="t:Boolean" xsi:type="IncludedIn">
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <signature xsi:type="IntervalTypeSpecifier">
                        <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="642" locator="333:11-333:33" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" scope="HospitalLocation" xsi:type="Property"/>
                     </operand>
                     <operand localId="644" locator="333:42-333:57" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <operand path="period" xsi:type="Property">
                           <source localId="643" locator="333:42-333:50" resultTypeName="fhir:Encounter" name="Encounter" xsi:type="OperandRef"/>
                        </operand>
                     </operand>
                  </operand>
               </where>
               <sort localId="650" locator="334:6-334:28">
                  <by localId="649" locator="334:14-334:28" resultTypeName="t:DateTime" direction="asc" xsi:type="ByExpression">
                     <expression localId="648" locator="334:14-334:28" resultTypeName="t:DateTime" xsi:type="Start">
                        <signature xsi:type="IntervalTypeSpecifier">
                           <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                        </signature>
                        <operand localId="647" locator="334:23-334:28" name="ToInterval" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                           <resultTypeSpecifier xsi:type="IntervalTypeSpecifier">
                              <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <operand name="period" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="631" locator="330:66-330:74" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="670" locator="340:1-342:81" name="EncounterDiagnosis" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="670">
               <a:s>/*
Returns the Condition resources referenced by the diagnosis element of the Encounter
*/
define function &quot;EncounterDiagnosis&quot;(Encounter </a:s>
               <a:s r="654">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="669">
                  <a:s r="669">
                     <a:s>
                        <a:s r="656">
                           <a:s r="655">
                              <a:s>
                                 <a:s>Encounter.diagnosis</a:s>
                              </a:s>
                           </a:s>
                           <a:s> D</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
	</a:s>
                     <a:s r="668">
                        <a:s>return </a:s>
                        <a:s r="667">
                           <a:s>singleton from </a:s>
                           <a:s r="666">
                              <a:s>(</a:s>
                              <a:s r="666">
                                 <a:s>
                                    <a:s r="658">
                                       <a:s r="657">
                                          <a:s r="657">
                                             <a:s>[Condition]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> C</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="665">
                                    <a:s>where </a:s>
                                    <a:s r="665">
                                       <a:s r="660">
                                          <a:s r="659">
                                             <a:s>C</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="660">
                                             <a:s>id</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> = </a:s>
                                       <a:s r="664">
                                          <a:s r="663">
                                             <a:s r="662">
                                                <a:s r="661">
                                                   <a:s>D</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="662">
                                                   <a:s>condition</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="663">
                                                <a:s>reference</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="664">
                                             <a:s>getId()</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="669" locator="341:3-342:81" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="656" locator="341:3-341:23" alias="D">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="655" locator="341:3-341:21" path="diagnosis" xsi:type="Property">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <source name="Encounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="668" locator="342:2-342:81">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="667" locator="342:9-342:81" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="666" locator="342:24-342:81" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="658" locator="342:25-342:37" alias="C">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="657" locator="342:25-342:35" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </expression>
                     </source>
                     <where localId="665" locator="342:39-342:80" resultTypeName="t:Boolean" xsi:type="Equal">
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="660" locator="342:45-342:48" resultTypeName="t:String" path="value" xsi:type="Property">
                           <source path="id" scope="C" xsi:type="Property"/>
                        </operand>
                        <operand localId="664" locator="342:52-342:80" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="663" locator="342:52-342:72" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="reference" xsi:type="Property">
                                 <source localId="662" locator="342:52-342:62" resultTypeName="fhir:Reference" path="condition" scope="D" xsi:type="Property"/>
                              </source>
                           </operand>
                        </operand>
                     </where>
                  </operand>
               </expression>
            </return>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="654" locator="340:48-340:56" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="687" locator="347:1-349:84" name="encounterDiagnosis" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="687">
               <a:s>/*
Returns the Condition resources referenced by the diagnosis element of the Encounter
*/
define fluent function encounterDiagnosis(Encounter </a:s>
               <a:s r="671">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="686">
                  <a:s r="686">
                     <a:s>
                        <a:s r="673">
                           <a:s r="672">
                              <a:s>
                                 <a:s>Encounter.diagnosis</a:s>
                              </a:s>
                           </a:s>
                           <a:s> D</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
    </a:s>
                     <a:s r="685">
                        <a:s>return </a:s>
                        <a:s r="684">
                           <a:s>singleton from </a:s>
                           <a:s r="683">
                              <a:s>(</a:s>
                              <a:s r="683">
                                 <a:s>
                                    <a:s r="675">
                                       <a:s r="674">
                                          <a:s r="674">
                                             <a:s>[Condition]</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> C</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> </a:s>
                                 <a:s r="682">
                                    <a:s>where </a:s>
                                    <a:s r="682">
                                       <a:s r="677">
                                          <a:s r="676">
                                             <a:s>C</a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="677">
                                             <a:s>id</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> = </a:s>
                                       <a:s r="681">
                                          <a:s r="680">
                                             <a:s r="679">
                                                <a:s r="678">
                                                   <a:s>D</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="679">
                                                   <a:s>condition</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="680">
                                                <a:s>reference</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s>.</a:s>
                                          <a:s r="681">
                                             <a:s>getId()</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                              <a:s>)</a:s>
                           </a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <resultTypeSpecifier xsi:type="ListTypeSpecifier">
            <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
         </resultTypeSpecifier>
         <expression localId="686" locator="348:3-349:84" xsi:type="Query">
            <resultTypeSpecifier xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </resultTypeSpecifier>
            <source localId="673" locator="348:3-348:23" alias="D">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="672" locator="348:3-348:21" path="diagnosis" xsi:type="Property">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <source name="Encounter" xsi:type="OperandRef"/>
               </expression>
            </source>
            <return localId="685" locator="349:5-349:84">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <expression localId="684" locator="349:12-349:84" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
                  <signature xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </signature>
                  <operand localId="683" locator="349:27-349:84" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="675" locator="349:28-349:40" alias="C">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="674" locator="349:28-349:38" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                        </expression>
                     </source>
                     <where localId="682" locator="349:42-349:83" resultTypeName="t:Boolean" xsi:type="Equal">
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="677" locator="349:48-349:51" resultTypeName="t:String" path="value" xsi:type="Property">
                           <source path="id" scope="C" xsi:type="Property"/>
                        </operand>
                        <operand localId="681" locator="349:55-349:83" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="680" locator="349:55-349:75" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="reference" xsi:type="Property">
                                 <source localId="679" locator="349:55-349:65" resultTypeName="fhir:Reference" path="condition" scope="D" xsi:type="Property"/>
                              </source>
                           </operand>
                        </operand>
                     </where>
                  </operand>
               </expression>
            </return>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="671" locator="347:53-347:61" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="699" locator="355:1-356:73" resultTypeName="fhir:Condition" name="GetCondition" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:t name="deprecated"/>
            <a:s r="699">
               <a:s>/*
Returns the Condition resource for the given reference
@deprecated
*/
define function &quot;GetCondition&quot;(reference </a:s>
               <a:s r="688">
                  <a:s>Reference</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="698">
                  <a:s r="698">
                     <a:s>singleton from </a:s>
                     <a:s r="697">
                        <a:s>(</a:s>
                        <a:s r="697">
                           <a:s>
                              <a:s r="690">
                                 <a:s r="689">
                                    <a:s r="689">
                                       <a:s>[Condition]</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> C</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="696">
                              <a:s>where </a:s>
                              <a:s r="696">
                                 <a:s r="692">
                                    <a:s r="691">
                                       <a:s>C</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="692">
                                       <a:s>id</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="695">
                                    <a:s r="694">
                                       <a:s r="693">
                                          <a:s>reference</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="694">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="695">
                                       <a:s>getId()</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="698" locator="356:3-356:73" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="697" locator="356:18-356:73" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="690" locator="356:19-356:31" alias="C">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="689" locator="356:19-356:29" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="696" locator="356:33-356:72" resultTypeName="t:Boolean" xsi:type="Equal">
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="692" locator="356:39-356:42" resultTypeName="t:String" path="value" xsi:type="Property">
                     <source path="id" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand localId="695" locator="356:46-356:72" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="694" locator="356:46-356:64" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source path="reference" xsi:type="Property">
                           <source localId="693" locator="356:46-356:54" resultTypeName="fhir:Reference" name="reference" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand name="reference">
            <operandTypeSpecifier localId="688" locator="355:42-355:50" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="711" locator="361:1-362:73" resultTypeName="fhir:Condition" name="getCondition" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="711">
               <a:s>/*
Returns the Condition resource for the given reference
*/
define fluent function getCondition(reference </a:s>
               <a:s r="700">
                  <a:s>Reference</a:s>
               </a:s>
               <a:s>):
  </a:s>
               <a:s r="710">
                  <a:s r="710">
                     <a:s>singleton from </a:s>
                     <a:s r="709">
                        <a:s>(</a:s>
                        <a:s r="709">
                           <a:s>
                              <a:s r="702">
                                 <a:s r="701">
                                    <a:s r="701">
                                       <a:s>[Condition]</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> C</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="708">
                              <a:s>where </a:s>
                              <a:s r="708">
                                 <a:s r="704">
                                    <a:s r="703">
                                       <a:s>C</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="704">
                                       <a:s>id</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="707">
                                    <a:s r="706">
                                       <a:s r="705">
                                          <a:s>reference</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="706">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="707">
                                       <a:s>getId()</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="710" locator="362:3-362:73" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="709" locator="362:18-362:73" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="702" locator="362:19-362:31" alias="C">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="701" locator="362:19-362:29" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="708" locator="362:33-362:72" resultTypeName="t:Boolean" xsi:type="Equal">
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="704" locator="362:39-362:42" resultTypeName="t:String" path="value" xsi:type="Property">
                     <source path="id" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand localId="707" locator="362:46-362:72" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="706" locator="362:46-362:64" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source path="reference" xsi:type="Property">
                           <source localId="705" locator="362:46-362:54" resultTypeName="fhir:Reference" name="reference" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand name="reference">
            <operandTypeSpecifier localId="700" locator="361:47-361:55" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="735" locator="367:1-370:2" resultTypeName="fhir:Condition" name="PrincipalDiagnosis" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="735">
               <a:s>/*
Returns the condition that is specified as the principal diagnosis for the encounter
*/
define function &quot;PrincipalDiagnosis&quot;(Encounter </a:s>
               <a:s r="712">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
	</a:s>
               <a:s r="734">
                  <a:s r="734">
                     <a:s>singleton from </a:s>
                     <a:s r="733">
                        <a:s>(</a:s>
                        <a:s r="733">
                           <a:s>
                              <a:s r="720">
                                 <a:s r="719">
                                    <a:s>(</a:s>
                                    <a:s r="719">
                                       <a:s>
                                          <a:s r="714">
                                             <a:s r="713">
                                                <a:s>
                                                   <a:s>Encounter.diagnosis</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> D</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="718">
                                          <a:s>where </a:s>
                                          <a:s r="718">
                                             <a:s r="716">
                                                <a:s r="715">
                                                   <a:s>D</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="716">
                                                   <a:s>rank</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s r="717"> = 1</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> PD</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      </a:s>
                           <a:s r="732">
                              <a:s>return </a:s>
                              <a:s r="731">
                                 <a:s>singleton from </a:s>
                                 <a:s r="730">
                                    <a:s>(</a:s>
                                    <a:s r="730">
                                       <a:s>
                                          <a:s r="722">
                                             <a:s r="721">
                                                <a:s r="721">
                                                   <a:s>[Condition]</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> C</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="729">
                                          <a:s>where </a:s>
                                          <a:s r="729">
                                             <a:s r="724">
                                                <a:s r="723">
                                                   <a:s>C</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="724">
                                                   <a:s>id</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> = </a:s>
                                             <a:s r="728">
                                                <a:s r="727">
                                                   <a:s r="726">
                                                      <a:s r="725">
                                                         <a:s>PD</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="726">
                                                         <a:s>condition</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="727">
                                                      <a:s>reference</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="728">
                                                   <a:s>getId()</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
	)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="734" locator="368:2-370:2" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="733" locator="368:17-370:2" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="720" locator="368:18-368:60" alias="PD">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="719" locator="368:18-368:57" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="714" locator="368:19-368:39" alias="D">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="713" locator="368:19-368:37" path="diagnosis" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source name="Encounter" xsi:type="OperandRef"/>
                        </expression>
                     </source>
                     <where localId="718" locator="368:41-368:56" resultTypeName="t:Boolean" xsi:type="Equal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="716" locator="368:47-368:52" resultTypeName="t:Integer" path="value" xsi:type="Property">
                           <source path="rank" scope="D" xsi:type="Property"/>
                        </operand>
                        <operand localId="717" locator="368:56" resultTypeName="t:Integer" valueType="t:Integer" value="1" xsi:type="Literal"/>
                     </where>
                  </expression>
               </source>
               <return localId="732" locator="369:7-369:87">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="731" locator="369:14-369:87" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="730" locator="369:29-369:87" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="722" locator="369:30-369:42" alias="C">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="721" locator="369:30-369:40" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <where localId="729" locator="369:44-369:86" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="724" locator="369:50-369:53" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="id" scope="C" xsi:type="Property"/>
                           </operand>
                           <operand localId="728" locator="369:57-369:86" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                              <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="727" locator="369:57-369:78" resultTypeName="t:String" path="value" xsi:type="Property">
                                 <source path="reference" xsi:type="Property">
                                    <source localId="726" locator="369:57-369:68" resultTypeName="fhir:Reference" path="condition" scope="PD" xsi:type="Property"/>
                                 </source>
                              </operand>
                           </operand>
                        </where>
                     </operand>
                  </expression>
               </return>
            </operand>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="712" locator="367:48-367:56" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="759" locator="375:1-378:2" resultTypeName="fhir:Condition" name="principalDiagnosis" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="759">
               <a:s>/*
Returns the condition that is specified as the principal diagnosis for the encounter
*/
define fluent function principalDiagnosis(Encounter </a:s>
               <a:s r="736">
                  <a:s>Encounter</a:s>
               </a:s>
               <a:s> ):
	</a:s>
               <a:s r="758">
                  <a:s r="758">
                     <a:s>singleton from </a:s>
                     <a:s r="757">
                        <a:s>(</a:s>
                        <a:s r="757">
                           <a:s>
                              <a:s r="744">
                                 <a:s r="743">
                                    <a:s>(</a:s>
                                    <a:s r="743">
                                       <a:s>
                                          <a:s r="738">
                                             <a:s r="737">
                                                <a:s>
                                                   <a:s>Encounter.diagnosis</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> D</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="742">
                                          <a:s>where </a:s>
                                          <a:s r="742">
                                             <a:s r="740">
                                                <a:s r="739">
                                                   <a:s>D</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="740">
                                                   <a:s>rank</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s r="741"> = 1</a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                                 <a:s> PD</a:s>
                              </a:s>
                           </a:s>
                           <a:s>
      </a:s>
                           <a:s r="756">
                              <a:s>return </a:s>
                              <a:s r="755">
                                 <a:s>singleton from </a:s>
                                 <a:s r="754">
                                    <a:s>(</a:s>
                                    <a:s r="754">
                                       <a:s>
                                          <a:s r="746">
                                             <a:s r="745">
                                                <a:s r="745">
                                                   <a:s>[Condition]</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> C</a:s>
                                          </a:s>
                                       </a:s>
                                       <a:s> </a:s>
                                       <a:s r="753">
                                          <a:s>where </a:s>
                                          <a:s r="753">
                                             <a:s r="748">
                                                <a:s r="747">
                                                   <a:s>C</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="748">
                                                   <a:s>id</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s> = </a:s>
                                             <a:s r="752">
                                                <a:s r="751">
                                                   <a:s r="750">
                                                      <a:s r="749">
                                                         <a:s>PD</a:s>
                                                      </a:s>
                                                      <a:s>.</a:s>
                                                      <a:s r="750">
                                                         <a:s>condition</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>.</a:s>
                                                   <a:s r="751">
                                                      <a:s>reference</a:s>
                                                   </a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="752">
                                                   <a:s>getId()</a:s>
                                                </a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>)</a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
	)</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="758" locator="376:2-378:2" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="757" locator="376:17-378:2" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="744" locator="376:18-376:60" alias="PD">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="743" locator="376:18-376:57" xsi:type="Query">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                     <source localId="738" locator="376:19-376:39" alias="D">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <expression localId="737" locator="376:19-376:37" path="diagnosis" xsi:type="Property">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Encounter.Diagnosis" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <source name="Encounter" xsi:type="OperandRef"/>
                        </expression>
                     </source>
                     <where localId="742" locator="376:41-376:56" resultTypeName="t:Boolean" xsi:type="Equal">
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <signature name="t:Integer" xsi:type="NamedTypeSpecifier"/>
                        <operand localId="740" locator="376:47-376:52" resultTypeName="t:Integer" path="value" xsi:type="Property">
                           <source path="rank" scope="D" xsi:type="Property"/>
                        </operand>
                        <operand localId="741" locator="376:56" resultTypeName="t:Integer" valueType="t:Integer" value="1" xsi:type="Literal"/>
                     </where>
                  </expression>
               </source>
               <return localId="756" locator="377:7-377:87">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="755" locator="377:14-377:87" resultTypeName="fhir:Condition" xsi:type="SingletonFrom">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="754" locator="377:29-377:87" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="746" locator="377:30-377:42" alias="C">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="745" locator="377:30-377:40" dataType="fhir:Condition" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-condition" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <where localId="753" locator="377:44-377:86" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="748" locator="377:50-377:53" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="id" scope="C" xsi:type="Property"/>
                           </operand>
                           <operand localId="752" locator="377:57-377:86" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                              <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="751" locator="377:57-377:78" resultTypeName="t:String" path="value" xsi:type="Property">
                                 <source path="reference" xsi:type="Property">
                                    <source localId="750" locator="377:57-377:68" resultTypeName="fhir:Reference" path="condition" scope="PD" xsi:type="Property"/>
                                 </source>
                              </operand>
                           </operand>
                        </where>
                     </operand>
                  </expression>
               </return>
            </operand>
         </expression>
         <operand name="Encounter">
            <operandTypeSpecifier localId="736" locator="375:53-375:61" resultTypeName="fhir:Encounter" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="773" locator="391:1-394:3" resultTypeName="fhir:Location" name="getLocation" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="773">
               <a:s>/*
Returns the Location resource specified by the given reference
*/
define fluent function getLocation(reference </a:s>
               <a:s r="762">
                  <a:s>Reference</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="772">
                  <a:s r="772">
                     <a:s>singleton from </a:s>
                     <a:s r="771">
                        <a:s>(
    </a:s>
                        <a:s r="771">
                           <a:s>
                              <a:s r="764">
                                 <a:s r="763">
                                    <a:s r="763">
                                       <a:s>[Location]</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> L</a:s>
                              </a:s>
                           </a:s>
                           <a:s> </a:s>
                           <a:s r="770">
                              <a:s>where </a:s>
                              <a:s r="770">
                                 <a:s r="766">
                                    <a:s r="765">
                                       <a:s>L</a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="766">
                                       <a:s>id</a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s> = </a:s>
                                 <a:s r="769">
                                    <a:s r="768">
                                       <a:s r="767">
                                          <a:s>reference</a:s>
                                       </a:s>
                                       <a:s>.</a:s>
                                       <a:s r="768">
                                          <a:s>reference</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s>.</a:s>
                                    <a:s r="769">
                                       <a:s>getId()</a:s>
                                    </a:s>
                                 </a:s>
                              </a:s>
                           </a:s>
                        </a:s>
                        <a:s>
  )</a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="772" locator="392:3-394:3" resultTypeName="fhir:Location" xsi:type="SingletonFrom">
            <signature xsi:type="ListTypeSpecifier">
               <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
            </signature>
            <operand localId="771" locator="392:18-394:3" xsi:type="Query">
               <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                  <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
               </resultTypeSpecifier>
               <source localId="764" locator="393:5-393:16" alias="L">
                  <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                     <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <expression localId="763" locator="393:5-393:14" dataType="fhir:Location" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-location" xsi:type="Retrieve">
                     <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Location" xsi:type="NamedTypeSpecifier"/>
                     </resultTypeSpecifier>
                  </expression>
               </source>
               <where localId="770" locator="393:18-393:57" resultTypeName="t:Boolean" xsi:type="Equal">
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                  <operand localId="766" locator="393:24-393:27" resultTypeName="t:String" path="value" xsi:type="Property">
                     <source path="id" scope="L" xsi:type="Property"/>
                  </operand>
                  <operand localId="769" locator="393:31-393:57" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                     <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                     <operand localId="768" locator="393:31-393:49" resultTypeName="t:String" path="value" xsi:type="Property">
                        <source path="reference" xsi:type="Property">
                           <source localId="767" locator="393:31-393:39" resultTypeName="fhir:Reference" name="reference" xsi:type="OperandRef"/>
                        </source>
                     </operand>
                  </operand>
               </where>
            </operand>
         </expression>
         <operand name="reference">
            <operandTypeSpecifier localId="762" locator="391:46-391:54" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="798" locator="399:1-403:108" resultTypeName="t:Concept" name="GetMedicationCode" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="798">
               <a:s>/*
Returns the medication code for the given MedicationRequest
*/
define function &quot;GetMedicationCode&quot;(request </a:s>
               <a:s r="774">
                  <a:s>MedicationRequest</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="797">
                  <a:s r="797">
                     <a:s>if </a:s>
                     <a:s r="778">
                        <a:s r="776">
                           <a:s r="775">
                              <a:s>request</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="776">
                              <a:s>medication</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is </a:s>
                        <a:s r="777">
                           <a:s>Concept</a:s>
                        </a:s>
                     </a:s>
                     <a:s> then
  	  </a:s>
                     <a:s r="782">
                        <a:s r="780">
                           <a:s r="779">
                              <a:s>request</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="780">
                              <a:s>medication</a:s>
                           </a:s>
                        </a:s>
                        <a:s> as </a:s>
                        <a:s r="781">
                           <a:s>Concept</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  	else
  	  </a:s>
                     <a:s r="796">
                        <a:s r="795">
                           <a:s>(</a:s>
                           <a:s r="795">
                              <a:s>singleton from </a:s>
                              <a:s r="794">
                                 <a:s>(</a:s>
                                 <a:s r="794">
                                    <a:s>
                                       <a:s r="784">
                                          <a:s r="783">
                                             <a:s r="783">
                                                <a:s>[Medication]</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> M</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> </a:s>
                                    <a:s r="793">
                                       <a:s>where </a:s>
                                       <a:s r="793">
                                          <a:s r="786">
                                             <a:s r="785">
                                                <a:s>M</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="786">
                                                <a:s>id</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="792">
                                             <a:s r="791">
                                                <a:s r="790">
                                                   <a:s>(</a:s>
                                                   <a:s r="790">
                                                      <a:s r="788">
                                                         <a:s r="787">
                                                            <a:s>request</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="788">
                                                            <a:s>medication</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> as </a:s>
                                                      <a:s r="789">
                                                         <a:s>Reference</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="791">
                                                   <a:s>reference</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="792">
                                                <a:s>getId()</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="796">
                           <a:s>code</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="797" locator="400:3-403:108" resultTypeName="t:Concept" xsi:type="If">
            <condition localId="778" locator="400:6-400:34" resultTypeName="t:Boolean" xsi:type="Is">
               <operand localId="776" locator="400:6-400:23" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <operand path="medication" xsi:type="Property">
                     <source localId="775" locator="400:6-400:12" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <isTypeSpecifier localId="777" locator="400:28-400:34" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
            </condition>
            <then localId="782" locator="401:6-401:34" resultTypeName="t:Concept" strict="false" xsi:type="As">
               <operand localId="780" locator="401:6-401:23" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <operand path="medication" xsi:type="Property">
                     <source localId="779" locator="401:6-401:12" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <asTypeSpecifier localId="781" locator="401:28-401:34" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
            </then>
            <else localId="796" locator="403:6-403:108" resultTypeName="t:Concept" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <operand path="code" xsi:type="Property">
                  <source localId="795" locator="403:6-403:103" resultTypeName="fhir:Medication" xsi:type="SingletonFrom">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="794" locator="403:22-403:102" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="784" locator="403:23-403:36" alias="M">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="783" locator="403:23-403:34" dataType="fhir:Medication" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-medication" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <where localId="793" locator="403:38-403:101" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="786" locator="403:44-403:47" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="id" scope="M" xsi:type="Property"/>
                           </operand>
                           <operand localId="792" locator="403:51-403:101" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                              <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="791" locator="403:51-403:93" resultTypeName="t:String" path="value" xsi:type="Property">
                                 <source path="reference" xsi:type="Property">
                                    <source localId="790" locator="403:51-403:83" resultTypeName="fhir:Reference" strict="false" xsi:type="As">
                                       <operand localId="788" locator="403:52-403:69" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                                             <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                                             <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="medication" xsi:type="Property">
                                             <source localId="787" locator="403:52-403:58" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                                          </operand>
                                       </operand>
                                       <asTypeSpecifier localId="789" locator="403:74-403:82" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                    </source>
                                 </source>
                              </operand>
                           </operand>
                        </where>
                     </operand>
                  </source>
               </operand>
            </else>
         </expression>
         <operand name="request">
            <operandTypeSpecifier localId="774" locator="399:45-399:61" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def localId="823" locator="408:1-412:108" resultTypeName="t:Concept" name="getMedicationCode" context="Patient" accessLevel="Public" fluent="true" xsi:type="FunctionDef">
         <annotation xsi:type="a:Annotation">
            <a:s r="823">
               <a:s>/*
Returns the medication code for the given MedicationRequest
*/
define fluent function getMedicationCode(request </a:s>
               <a:s r="799">
                  <a:s>MedicationRequest</a:s>
               </a:s>
               <a:s> ):
  </a:s>
               <a:s r="822">
                  <a:s r="822">
                     <a:s>if </a:s>
                     <a:s r="803">
                        <a:s r="801">
                           <a:s r="800">
                              <a:s>request</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="801">
                              <a:s>medication</a:s>
                           </a:s>
                        </a:s>
                        <a:s> is </a:s>
                        <a:s r="802">
                           <a:s>Concept</a:s>
                        </a:s>
                     </a:s>
                     <a:s> then
  	  </a:s>
                     <a:s r="807">
                        <a:s r="805">
                           <a:s r="804">
                              <a:s>request</a:s>
                           </a:s>
                           <a:s>.</a:s>
                           <a:s r="805">
                              <a:s>medication</a:s>
                           </a:s>
                        </a:s>
                        <a:s> as </a:s>
                        <a:s r="806">
                           <a:s>Concept</a:s>
                        </a:s>
                     </a:s>
                     <a:s>
  	else
  	  </a:s>
                     <a:s r="821">
                        <a:s r="820">
                           <a:s>(</a:s>
                           <a:s r="820">
                              <a:s>singleton from </a:s>
                              <a:s r="819">
                                 <a:s>(</a:s>
                                 <a:s r="819">
                                    <a:s>
                                       <a:s r="809">
                                          <a:s r="808">
                                             <a:s r="808">
                                                <a:s>[Medication]</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> M</a:s>
                                       </a:s>
                                    </a:s>
                                    <a:s> </a:s>
                                    <a:s r="818">
                                       <a:s>where </a:s>
                                       <a:s r="818">
                                          <a:s r="811">
                                             <a:s r="810">
                                                <a:s>M</a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="811">
                                                <a:s>id</a:s>
                                             </a:s>
                                          </a:s>
                                          <a:s> = </a:s>
                                          <a:s r="817">
                                             <a:s r="816">
                                                <a:s r="815">
                                                   <a:s>(</a:s>
                                                   <a:s r="815">
                                                      <a:s r="813">
                                                         <a:s r="812">
                                                            <a:s>request</a:s>
                                                         </a:s>
                                                         <a:s>.</a:s>
                                                         <a:s r="813">
                                                            <a:s>medication</a:s>
                                                         </a:s>
                                                      </a:s>
                                                      <a:s> as </a:s>
                                                      <a:s r="814">
                                                         <a:s>Reference</a:s>
                                                      </a:s>
                                                   </a:s>
                                                   <a:s>)</a:s>
                                                </a:s>
                                                <a:s>.</a:s>
                                                <a:s r="816">
                                                   <a:s>reference</a:s>
                                                </a:s>
                                             </a:s>
                                             <a:s>.</a:s>
                                             <a:s r="817">
                                                <a:s>getId()</a:s>
                                             </a:s>
                                          </a:s>
                                       </a:s>
                                    </a:s>
                                 </a:s>
                                 <a:s>)</a:s>
                              </a:s>
                           </a:s>
                           <a:s>)</a:s>
                        </a:s>
                        <a:s>.</a:s>
                        <a:s r="821">
                           <a:s>code</a:s>
                        </a:s>
                     </a:s>
                  </a:s>
               </a:s>
            </a:s>
         </annotation>
         <expression localId="822" locator="409:3-412:108" resultTypeName="t:Concept" xsi:type="If">
            <condition localId="803" locator="409:6-409:34" resultTypeName="t:Boolean" xsi:type="Is">
               <operand localId="801" locator="409:6-409:23" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <operand path="medication" xsi:type="Property">
                     <source localId="800" locator="409:6-409:12" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <isTypeSpecifier localId="802" locator="409:28-409:34" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
            </condition>
            <then localId="807" locator="410:6-410:34" resultTypeName="t:Concept" strict="false" xsi:type="As">
               <operand localId="805" locator="410:6-410:23" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                     <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                     <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                  </resultTypeSpecifier>
                  <operand path="medication" xsi:type="Property">
                     <source localId="804" locator="410:6-410:12" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                  </operand>
               </operand>
               <asTypeSpecifier localId="806" locator="410:28-410:34" resultTypeName="t:Concept" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
            </then>
            <else localId="821" locator="412:6-412:108" resultTypeName="t:Concept" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
               <operand path="code" xsi:type="Property">
                  <source localId="820" locator="412:6-412:103" resultTypeName="fhir:Medication" xsi:type="SingletonFrom">
                     <signature xsi:type="ListTypeSpecifier">
                        <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                     </signature>
                     <operand localId="819" locator="412:22-412:102" xsi:type="Query">
                        <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                           <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                        </resultTypeSpecifier>
                        <source localId="809" locator="412:23-412:36" alias="M">
                           <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                              <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                           </resultTypeSpecifier>
                           <expression localId="808" locator="412:23-412:34" dataType="fhir:Medication" templateId="http://hl7.org/fhir/us/qicore/StructureDefinition/qicore-medication" xsi:type="Retrieve">
                              <resultTypeSpecifier xsi:type="ListTypeSpecifier">
                                 <elementType name="fhir:Medication" xsi:type="NamedTypeSpecifier"/>
                              </resultTypeSpecifier>
                           </expression>
                        </source>
                        <where localId="818" locator="412:38-412:101" resultTypeName="t:Boolean" xsi:type="Equal">
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                           <operand localId="811" locator="412:44-412:47" resultTypeName="t:String" path="value" xsi:type="Property">
                              <source path="id" scope="M" xsi:type="Property"/>
                           </operand>
                           <operand localId="817" locator="412:51-412:101" resultTypeName="t:String" name="getId" libraryName="QICoreCommon" xsi:type="FunctionRef">
                              <signature name="t:String" xsi:type="NamedTypeSpecifier"/>
                              <operand localId="816" locator="412:51-412:93" resultTypeName="t:String" path="value" xsi:type="Property">
                                 <source path="reference" xsi:type="Property">
                                    <source localId="815" locator="412:51-412:83" resultTypeName="fhir:Reference" strict="false" xsi:type="As">
                                       <operand localId="813" locator="412:52-412:69" name="ToValue" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                                          <resultTypeSpecifier xsi:type="ChoiceTypeSpecifier">
                                             <choice name="t:Concept" xsi:type="NamedTypeSpecifier"/>
                                             <choice name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                          </resultTypeSpecifier>
                                          <operand path="medication" xsi:type="Property">
                                             <source localId="812" locator="412:52-412:58" resultTypeName="fhir:MedicationRequest" name="request" xsi:type="OperandRef"/>
                                          </operand>
                                       </operand>
                                       <asTypeSpecifier localId="814" locator="412:74-412:82" resultTypeName="fhir:Reference" name="fhir:Reference" xsi:type="NamedTypeSpecifier"/>
                                    </source>
                                 </source>
                              </operand>
                           </operand>
                        </where>
                     </operand>
                  </source>
               </operand>
            </else>
         </expression>
         <operand name="request">
            <operandTypeSpecifier localId="799" locator="408:50-408:66" resultTypeName="fhir:MedicationRequest" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
   </statements>
</library>
